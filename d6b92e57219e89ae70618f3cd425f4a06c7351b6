{
  "comments": [
    {
      "key": {
        "uuid": "46648e01_cac98b97",
        "filename": "lib/blob/blobstore.c",
        "patchSetId": 7
      },
      "lineNbr": 1386,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2020-01-17T21:05:01Z",
      "side": 1,
      "message": "last_extent_page?",
      "revId": "d6b92e57219e89ae70618f3cd425f4a06c7351b6",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "394a34f9_884b690c",
        "filename": "lib/blob/blobstore.c",
        "patchSetId": 7
      },
      "lineNbr": 1386,
      "author": {
        "id": 1011221
      },
      "writtenOn": "2020-01-21T12:44:31Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "46648e01_cac98b97",
      "revId": "d6b92e57219e89ae70618f3cd425f4a06c7351b6",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2816cae6_9cfbe5cb",
        "filename": "lib/blob/blobstore.c",
        "patchSetId": 7
      },
      "lineNbr": 1824,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2020-01-17T21:05:01Z",
      "side": 1,
      "message": "I think you can drop \"single\" from the name here.  At least for me, the \"pages\" v. \"page\" distinction is enough.",
      "revId": "d6b92e57219e89ae70618f3cd425f4a06c7351b6",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0ec7860c_6ad5d660",
        "filename": "lib/blob/blobstore.c",
        "patchSetId": 7
      },
      "lineNbr": 1824,
      "author": {
        "id": 1011221
      },
      "writtenOn": "2020-01-21T12:44:31Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "2816cae6_9cfbe5cb",
      "revId": "d6b92e57219e89ae70618f3cd425f4a06c7351b6",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "65f795a8_fde37e71",
        "filename": "lib/blob/blobstore.c",
        "patchSetId": 7
      },
      "lineNbr": 1861,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2020-01-17T21:05:01Z",
      "side": 1,
      "message": "only for extent pages that were changed?\n\nOr more concisely:\n\nOnly write out changed extent pages",
      "revId": "d6b92e57219e89ae70618f3cd425f4a06c7351b6",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0ab0f0a9_f67326f9",
        "filename": "lib/blob/blobstore.c",
        "patchSetId": 7
      },
      "lineNbr": 1861,
      "author": {
        "id": 1011221
      },
      "writtenOn": "2020-01-21T12:44:31Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "65f795a8_fde37e71",
      "revId": "d6b92e57219e89ae70618f3cd425f4a06c7351b6",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "21481a78_cec40cc1",
        "filename": "lib/blob/blobstore.c",
        "patchSetId": 7
      },
      "lineNbr": 1865,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2020-01-17T21:05:01Z",
      "side": 1,
      "message": "Shouldn\u0027t the \u003e be \u003e\u003d here?  I feel like the \u003d\u003d 0 case may have been added because in the most common case (when we create a new blob), the clean_size \u003d\u003d 0, and when i \u003d\u003d 0, we wouldn\u0027t fall into this code block since it was using \u003e instead of \u003e\u003d.\n\nAnd then in that case, you could remove the \u003d\u003d 0 check.\n\nBut please don\u0027t take my word for this.  I\u0027m still fully working through it in my head.",
      "revId": "d6b92e57219e89ae70618f3cd425f4a06c7351b6",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "476231bf_9bf466d6",
        "filename": "lib/blob/blobstore.c",
        "patchSetId": 7
      },
      "lineNbr": 1865,
      "author": {
        "id": 1011221
      },
      "writtenOn": "2020-01-21T12:44:31Z",
      "side": 1,
      "message": "Yup, that is the right way.",
      "parentUuid": "21481a78_cec40cc1",
      "revId": "d6b92e57219e89ae70618f3cd425f4a06c7351b6",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "56f9bfbb_e71e7dbc",
        "filename": "lib/blob/blobstore.c",
        "patchSetId": 7
      },
      "lineNbr": 1869,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2020-01-17T21:05:01Z",
      "side": 1,
      "message": "I said we should change last_extent to last_extent_page above, but really I think next_extent_page would be more clear.  last_extent_page seems to me to mean the last one that we processed, but really you\u0027re using this to track the next one to be processed.\n\nI also think \"i + 1\" is better than \"++i\" here.  There\u0027s no need to modify \"I\" since you\u0027re returning immediately afterwards.  Additional case of this below.",
      "revId": "d6b92e57219e89ae70618f3cd425f4a06c7351b6",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "72da5963_92011a0e",
        "filename": "lib/blob/blobstore.c",
        "patchSetId": 7
      },
      "lineNbr": 1869,
      "author": {
        "id": 1011221
      },
      "writtenOn": "2020-01-21T12:44:31Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "56f9bfbb_e71e7dbc",
      "revId": "d6b92e57219e89ae70618f3cd425f4a06c7351b6",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a8c67c81_a2c1257d",
        "filename": "lib/blob/blobstore.c",
        "patchSetId": 7
      },
      "lineNbr": 1872,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2020-01-17T21:05:01Z",
      "side": 1,
      "message": "We know that extent_page_id !\u003d 0 here.  So what is the case where these two could be unequal?  Is it where we shrink the blob and then immediately grow it?  If so, please add a comment here to explain that further.\n\nWait - no, that can\u0027t be it.  You\u0027re asserting just below that clean.extent_pages[i] \u003d\u003d 0.\n\nShould this be:\n\nif (blob-\u003eclean.extent_pages[i] \u003d\u003d 0) {\n\ninstead?  I think that\u0027s more clear.  You could also consider combining this if with the if on the previous line, to remove one level of indenting.",
      "revId": "d6b92e57219e89ae70618f3cd425f4a06c7351b6",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e06f5374_418ac19b",
        "filename": "lib/blob/blobstore.c",
        "patchSetId": 7
      },
      "lineNbr": 1872,
      "author": {
        "id": 1011221
      },
      "writtenOn": "2020-01-21T12:44:31Z",
      "side": 1,
      "message": "This whole block can be thrown out.\n\nThere logic here should be to iterate over active extent pages array. If they are allocated (!\u003d0) write down any that aren\u0027t yet on disk. It is assumed that all of the ones in clean extent pages array already are on disk. Two cases here:\n- active is larger than clean, so all allocated extent pages should be written out\n- clean and active is smaller or equal, then write out only when clean.extent_pages[i] \u003d\u003d 0 and extent_page_id !\u003d 0\n\nSecond case can be true for thin provisioned blobs, this function is called as part of persist when extent table needs to be updated too (new extent page).\n\nAs for changing of sizes multiple times before syncing - extent_pages_array will only grow when doing resizes without sync. Now that I think about it, it might be possible that we write out extent pages here and then have to remove them at the end of persist. Should still end up with the right amount at the end. If blob started with 0, then was resized to large cluster size and shrunk down to 0 - additional writes would be done to persist all extent pages and then to remove them. Expectation here probably is to not write out any extent pages in such case.\nI\u0027ve this loop to iterate over num_extent_pages rather than extent_pages_array_size.",
      "parentUuid": "a8c67c81_a2c1257d",
      "revId": "d6b92e57219e89ae70618f3cd425f4a06c7351b6",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    }
  ]
}