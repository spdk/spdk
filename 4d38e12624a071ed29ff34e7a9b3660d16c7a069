{
  "comments": [
    {
      "key": {
        "uuid": "887bc2a5_3b1fdd23",
        "filename": "lib/vhost/vhost_scsi.c",
        "patchSetId": 1
      },
      "lineNbr": 1365,
      "author": {
        "id": 1011218
      },
      "writtenOn": "2019-03-01T21:05:51Z",
      "side": 1,
      "message": "Ah, I see we can allocate an io_channel via hotplug event after this poller has finished, but before spdk_vhost_scsi_stop has unset vsession-\u003elcore. Would it make the problem go away if we unset vsession-\u003elcore right here?",
      "revId": "4d38e12624a071ed29ff34e7a9b3660d16c7a069",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1ffa60ed_dbe31354",
        "filename": "lib/vhost/vhost_scsi.c",
        "patchSetId": 1
      },
      "lineNbr": 1365,
      "author": {
        "id": 1011230
      },
      "writtenOn": "2019-03-04T09:36:54Z",
      "side": 1,
      "message": "The main issue is that the spdk_vhost_session_send_event() is unlocking mutex. This is opening a slot for RPC thread to issue eg add or remove target request while this poller is still running (vsession-\u003etask_cnt \u003e 0).\n\nFrom others side: I removed unlocking part from spdk_vhost_session_send_event() to give it a try and hit deadlock :/",
      "parentUuid": "887bc2a5_3b1fdd23",
      "revId": "4d38e12624a071ed29ff34e7a9b3660d16c7a069",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "55d5457f_ad1720a1",
        "filename": "lib/vhost/vhost_scsi.c",
        "patchSetId": 1
      },
      "lineNbr": 1365,
      "author": {
        "id": 1011218
      },
      "writtenOn": "2019-03-04T15:33:29Z",
      "side": 1,
      "message": "\u003e The main issue is that the spdk_vhost_session_send_event() is unlocking mutex. This is opening a slot for RPC thread to issue eg add or remove target request while this poller is still running (vsession-\u003etask_cnt \u003e 0).\n\nThis shouldn\u0027t cause any trouble. The session is perfectly usable until we start freeing its io_channels. Can you shed some more light on the actual problem here?",
      "parentUuid": "1ffa60ed_dbe31354",
      "revId": "4d38e12624a071ed29ff34e7a9b3660d16c7a069",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    }
  ]
}