{
  "comments": [
    {
      "key": {
        "uuid": "065d8361_a9b67aed",
        "filename": "lib/bdev/bdev.c",
        "patchSetId": 28
      },
      "lineNbr": 1080,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2018-01-29T09:25:00Z",
      "side": 1,
      "message": "I think by using callback for completion of destroy(), the next create() may be able to be serialized. Hence this operation may become unnecessary. I think Serializing control operation is better than asynchronous complexity that you fix by qos_channel_destroying flag.\n\nHow do you think?",
      "range": {
        "startLine": 1077,
        "startChar": 0,
        "endLine": 1080,
        "endChar": 4
      },
      "revId": "2035f772f1ceb958ca5fa88050cf86d821816386",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e4883cf9_e0cc145b",
        "filename": "lib/bdev/bdev.c",
        "patchSetId": 28
      },
      "lineNbr": 1113,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2018-01-29T09:25:00Z",
      "side": 1,
      "message": "Looks fine.",
      "range": {
        "startLine": 1113,
        "startChar": 0,
        "endLine": 1113,
        "endChar": 29
      },
      "revId": "2035f772f1ceb958ca5fa88050cf86d821816386",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8bfb3079_b0430620",
        "filename": "lib/bdev/bdev.c",
        "patchSetId": 28
      },
      "lineNbr": 1279,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2018-01-29T09:25:00Z",
      "side": 1,
      "message": "Even if bdev-\u003echannel_count must be guarded by mutex, the value of count should be cached.\n\nTwo channel may observe count \u003d\u003d 0 simultaneously.\nthread 1: count-- -\u003e count \u003d 1\nthread 2: count-- -\u003e count \u003d 0\nboth thread 1 and thread 2 may observe count \u003d\u003d 0 in the if() condition.\n\n\npthread_mutex_lock(\u0026bdev-\u003emutex);\nbdev-\u003echannel_count--;\ncount \u003d bdev-\u003echannel_count;\npthread_mutex_unlock(\u0026bdev-\u003emutex);\nif (count \u003d\u003d 0 \u0026\u0026 ...)",
      "range": {
        "startLine": 1279,
        "startChar": 5,
        "endLine": 1279,
        "endChar": 24
      },
      "revId": "2035f772f1ceb958ca5fa88050cf86d821816386",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    }
  ]
}