{
  "comments": [
    {
      "key": {
        "uuid": "98b6ffab_e43e689e",
        "filename": "lib/nvmf/subsystem.c",
        "patchSetId": 6
      },
      "lineNbr": 417,
      "author": {
        "id": 1016870
      },
      "writtenOn": "2019-09-09T01:38:04Z",
      "side": 1,
      "message": "I think we should revert to use both \"expected_old_state\" and \"old_state\".\n\nThe code here is strange, it actually does nothing.\nif (old_state \u003d\u003d SPDK_NVMF_SUBSYSTEM_RESUMING \u0026\u0026 state \u003d\u003d xxxx) {\n    old_state \u003d  SPDK_NVMF_SUBSYSTEM_RESUMING;\n}\n\nIn original code, \"expected_old_state\" is const, it won\u0027t be changed by __sync_val_compare_and_swap(line 407). But in new code, \"old_state\" will be changed by __atomic_compare_exchange_n(line 408).\n\nAt line 418, \"old_state\" in new code can be different from \"expected_old_state\" in old code.",
      "range": {
        "startLine": 410,
        "startChar": 41,
        "endLine": 417,
        "endChar": 3
      },
      "revId": "0c399e53bdbd47af25650d2a20b347cbc4434f93",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    }
  ]
}