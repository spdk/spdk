{
  "comments": [
    {
      "key": {
        "uuid": "9ec2cab9_f3265733",
        "filename": "lib/scsi/scsi_bdev.c",
        "patchSetId": 1
      },
      "lineNbr": 1495,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2018-07-03T16:58:13Z",
      "side": 1,
      "message": "I don\u0027t think this is quite right.  SCSI unmap may pass multiple descriptors - we turn each into a separate bdev_unmap_blocks command.  Each of those are completed by this function.\n\nSo the previous code was handling the case where there are multiple descriptors, maybe the first one succeeds but the second one fails.  It could just look at status \u003d\u003d GOOD, because status gets initialized to GOOD implicitly (it is memset to 0).\n\nI think you should just keep the status \u003d\u003d GOOD here.  Note that spdk_scsi_lun_execute_task already explicitly sets task-\u003estatus \u003d SPDK_SCSI_STATUS_GOOD so even by removing the spdk_scsi_task_set_status in spdk_bdev_scsi_unmap, status should still equal GOOD.  It might be good to put an assert in spdk_bdev_scsi_unmap for now, ensuring the status \u003d\u003d GOOD since the completion path depends on it.\n\nMaybe later, we can add something like SPDK_SCSI_STATUS_INVALID (\u003d0xFF?) and use that in spdk_scsi_lun_execute_task().  I\u0027m not sure what kind of fallout we\u0027d get from that change so I\u0027d suggest we do that later (if at all).",
      "revId": "b6d7feefa42a8d1c2e89108ae70763e6e8d11faf",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    }
  ]
}