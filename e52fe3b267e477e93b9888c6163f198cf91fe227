{
  "comments": [
    {
      "key": {
        "uuid": "5a3d2b55_9088368f",
        "filename": "lib/bdev/error/vbdev_error.c",
        "patchSetId": 2
      },
      "lineNbr": 59,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2017-05-26T23:06:37Z",
      "side": 1,
      "message": "I understand why you needed to add this vbdev_io structure.  What if instead, we added a new TAILQ_ENTRY to struct spdk_bdev_io called module_link.  The comment should say that it may be used by modules to put the bdev_io into its own list.  It must remove the bdev_io from this list before resubmitting the I/O to another bdev module.",
      "revId": "e52fe3b267e477e93b9888c6163f198cf91fe227",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "152a11ff_86962898",
        "filename": "lib/bdev/error/vbdev_error.c",
        "patchSetId": 2
      },
      "lineNbr": 66,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2017-05-26T23:06:37Z",
      "side": 1,
      "message": "I have a concern about a single global list for these I/Os.  It means if I have two error vbdevs A and B, the following could occur:\n\n1) enable error injection w/ reset testing\n2) I/O goes to vbdev A\n3) reset goes to vbdev B\n\n#3 will cause the I/O from #2 to complete\n\nWhat if each vbdev_error_disk had its own vbdev_ios list?\n\nBefore making that change, should we also put io_type_mask and error_num in the vbdev_error_disk?  Then we can control the error injection much better on a per device basis.",
      "revId": "e52fe3b267e477e93b9888c6163f198cf91fe227",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "93f236a9_4ebbfbb3",
        "filename": "lib/bdev/error/vbdev_error.c",
        "patchSetId": 2
      },
      "lineNbr": 93,
      "author": {
        "id": 1011207
      },
      "writtenOn": "2017-05-26T01:43:57Z",
      "side": 1,
      "message": "By the way, will you check whether \"vbdevio-\u003ebdev_io \u003d\u003d bdev_io\" before removing this vbdev_io?",
      "range": {
        "startLine": 93,
        "startChar": 2,
        "endLine": 93,
        "endChar": 46
      },
      "revId": "e52fe3b267e477e93b9888c6163f198cf91fe227",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8cf44a16_96c863e4",
        "filename": "lib/bdev/error/vbdev_error.c",
        "patchSetId": 2
      },
      "lineNbr": 93,
      "author": {
        "id": 1011231
      },
      "writtenOn": "2017-05-26T01:51:18Z",
      "side": 1,
      "message": "of course not, here the bdev_io will absolutely not \u003d\u003d the vbdevio-\u003ebdev_io, the bdev_io here is for reset command, they are completely different.",
      "parentUuid": "93f236a9_4ebbfbb3",
      "range": {
        "startLine": 93,
        "startChar": 2,
        "endLine": 93,
        "endChar": 46
      },
      "revId": "e52fe3b267e477e93b9888c6163f198cf91fe227",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "17a455ad_f20c132a",
        "filename": "lib/bdev/error/vbdev_error.c",
        "patchSetId": 2
      },
      "lineNbr": 134,
      "author": {
        "id": 1011207
      },
      "writtenOn": "2017-06-01T09:28:40Z",
      "side": 1,
      "message": "If moving this lock acquisition at line 127 (before the g_error_num \u003d\u003d 0 check, looks like we can remove the double check at line 146.",
      "range": {
        "startLine": 134,
        "startChar": 1,
        "endLine": 134,
        "endChar": 42
      },
      "revId": "e52fe3b267e477e93b9888c6163f198cf91fe227",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1f33875f_a0c29bad",
        "filename": "lib/bdev/error/vbdev_error.c",
        "patchSetId": 2
      },
      "lineNbr": 135,
      "author": {
        "id": 1011207
      },
      "writtenOn": "2017-05-25T23:25:34Z",
      "side": 1,
      "message": "Maybe we can move this check before the g_io_type_mask check. This is also consistent with above line 128.",
      "range": {
        "startLine": 135,
        "startChar": 57,
        "endLine": 135,
        "endChar": 68
      },
      "revId": "e52fe3b267e477e93b9888c6163f198cf91fe227",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c7a88acd_0dac0745",
        "filename": "lib/bdev/error/vbdev_error.c",
        "patchSetId": 2
      },
      "lineNbr": 135,
      "author": {
        "id": 1011231
      },
      "writtenOn": "2017-05-25T23:53:39Z",
      "side": 1,
      "message": "it is different logic usage, here is for those command will be buffered when the reset mask is set.",
      "parentUuid": "1f33875f_a0c29bad",
      "range": {
        "startLine": 135,
        "startChar": 57,
        "endLine": 135,
        "endChar": 68
      },
      "revId": "e52fe3b267e477e93b9888c6163f198cf91fe227",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c4e3416b_e4f3c4fb",
        "filename": "lib/bdev/error/vbdev_error.c",
        "patchSetId": 2
      },
      "lineNbr": 142,
      "author": {
        "id": 1011207
      },
      "writtenOn": "2017-05-25T23:25:34Z",
      "side": 1,
      "message": "Where is the mutex locked? Shall call it before the INSERT_TAIL ?",
      "range": {
        "startLine": 142,
        "startChar": 2,
        "endLine": 142,
        "endChar": 22
      },
      "revId": "e52fe3b267e477e93b9888c6163f198cf91fe227",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "270a3e38_a64af8eb",
        "filename": "lib/bdev/error/vbdev_error.c",
        "patchSetId": 2
      },
      "lineNbr": 142,
      "author": {
        "id": 1011231
      },
      "writtenOn": "2017-05-25T23:53:39Z",
      "side": 1,
      "message": "line 134 locked, we can not call before insert tail, it used for all the following block.",
      "parentUuid": "c4e3416b_e4f3c4fb",
      "range": {
        "startLine": 142,
        "startChar": 2,
        "endLine": 142,
        "endChar": 22
      },
      "revId": "e52fe3b267e477e93b9888c6163f198cf91fe227",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "db227c96_8b4d4d37",
        "filename": "lib/bdev/error/vbdev_error.c",
        "patchSetId": 2
      },
      "lineNbr": 142,
      "author": {
        "id": 1011207
      },
      "writtenOn": "2017-05-26T01:43:57Z",
      "side": 1,
      "message": "Yes. Sorry to did not see that line.",
      "parentUuid": "270a3e38_a64af8eb",
      "range": {
        "startLine": 142,
        "startChar": 2,
        "endLine": 142,
        "endChar": 22
      },
      "revId": "e52fe3b267e477e93b9888c6163f198cf91fe227",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "95fd8699_f3f9aab6",
        "filename": "lib/bdev/error/vbdev_error_rpc.c",
        "patchSetId": 2
      },
      "lineNbr": 59,
      "author": {
        "id": 1010525
      },
      "writtenOn": "2017-05-31T01:31:06Z",
      "side": 1,
      "message": "This looks pretty error-prone; maybe this would be nicer:\n\n   return 0xffffffff - (1U \u003c\u003c SPDK_BDEV_IO_TYPE_RESET);",
      "revId": "e52fe3b267e477e93b9888c6163f198cf91fe227",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    }
  ]
}