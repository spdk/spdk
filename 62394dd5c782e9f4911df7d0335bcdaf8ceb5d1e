{
  "comments": [
    {
      "key": {
        "uuid": "dae0116a_76b7f56f",
        "filename": "scripts/setup.sh",
        "patchSetId": 18
      },
      "lineNbr": 273,
      "author": {
        "id": 1010525
      },
      "writtenOn": "2017-10-06T23:00:50Z",
      "side": 1,
      "message": "This still seems to be assuming a single global hugepage size; I think it would be best to support 1 GB and 2 MB hugepages at the same time, and I think the rest of your changes are trying to support that (if I understand it correctly).\n\nThis is how I think it should work:\n- User specifies the total desired size of hugepage memory in $HUGEMEM.\n- Check the number of hugepages currently available for each size (1 GB, 2 MB) and count up to $HUGEMEM.\n- If needed, configure nr_hugepages for each available size (1 GB, 2 MB) until the user\u0027s $HUGEMEM value is satisfied.  This may require some special cases, since 2 MB hugepages can be allocated dynamically but as far as I know, 1 GB hugepages can\u0027t (they must be reserved at boot time).\n- Mount a hugetlbfs for each hugepage size we have allocated above.\n\nThese steps should use /sys/kernel/mm/hugepages/hugepages-* - there will be one directory for each supported hugepage size: hugepages-1048576kB and hugepages-2048kB.  Each of those directories contains a nr_hugepages file that indicates how much space is allocated.\n\nThis will mean that some of the existing code will need to change - we can\u0027t assume that there is just one hugetlbfs mount point, like we are currently doing in linux_hugetlbfs_mount, since there will be one hugetlbfs per page size.  Also, there won\u0027t be a $HUGEPAGESZ variable, since there will be potentially more than one size of hugepage at once.",
      "revId": "62394dd5c782e9f4911df7d0335bcdaf8ceb5d1e",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "74e66e3b_8362f37a",
        "filename": "scripts/setup.sh",
        "patchSetId": 18
      },
      "lineNbr": 273,
      "author": {
        "id": 1011256
      },
      "writtenOn": "2017-10-09T10:13:09Z",
      "side": 1,
      "message": "Daniel, not sure if I understand correctly so I need to ask:\n\" I think it would be best to support 1 GB and 2 MB hugepages at the same time\" - does that mean if I call setup.sh with HUGEMEM\u003d1024 then according toy your description I\u0027d need to reserve 1024MB for both 2MB HP\u0027s AND for 1GB HP\u0027s?\nIf so, then why?",
      "parentUuid": "dae0116a_76b7f56f",
      "revId": "62394dd5c782e9f4911df7d0335bcdaf8ceb5d1e",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "eb163651_c10c2c5d",
        "filename": "scripts/setup.sh",
        "patchSetId": 18
      },
      "lineNbr": 273,
      "author": {
        "id": 1010525
      },
      "writtenOn": "2017-10-09T18:13:02Z",
      "side": 1,
      "message": "No, what I would prefer here is that if HUGEMEM\u003d1024 and a 1 GB hugepage is available, we would just reserve 1024 MB via one 1 GB page, and no 2 MB pages would be configured.  It gets more complicated if the user asks for e.g. 1.5 GB and we have both 1 GB and 2 MB pages available - we\u0027d probably want to allocate 1x1 GB page and 256x2 MB pages.",
      "parentUuid": "74e66e3b_8362f37a",
      "revId": "62394dd5c782e9f4911df7d0335bcdaf8ceb5d1e",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    }
  ]
}