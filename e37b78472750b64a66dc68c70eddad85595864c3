{
  "comments": [
    {
      "key": {
        "uuid": "051d7b4b_d7945279",
        "filename": "lib/nvmf/rdma.c",
        "patchSetId": 5
      },
      "lineNbr": 605,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2019-02-11T18:34:56Z",
      "side": 1,
      "message": "Should this be an assert? We should catch anywhere that this is being called that hasn\u0027t gone down the main disconnect path.",
      "revId": "e37b78472750b64a66dc68c70eddad85595864c3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "92f83225_1aa7c21a",
        "filename": "lib/nvmf/rdma.c",
        "patchSetId": 5
      },
      "lineNbr": 605,
      "author": {
        "id": 1011223
      },
      "writtenOn": "2019-02-12T16:45:32Z",
      "side": 1,
      "message": "Thanks for pointing this out. I can\u0027t even do this check yet actually. I will need to fix the paths in qpair_init and poll_group_destroy before I can. It\u0027s possible that both of those paths are called out of tree. I can do the qpair_init paths after I remove the activating state, then the poll_group_destroy call will require a little more plumbing.\nOnce I fix all of the paths I will make this an assert.",
      "parentUuid": "051d7b4b_d7945279",
      "revId": "e37b78472750b64a66dc68c70eddad85595864c3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "695007c9_af59f3eb",
        "filename": "lib/nvmf/rdma.c",
        "patchSetId": 5
      },
      "lineNbr": 605,
      "author": {
        "id": 1011223
      },
      "writtenOn": "2019-02-12T17:16:07Z",
      "side": 1,
      "message": "On second thought, we can\u0027t enforce this in the destroy function. We need to destroy qpairs when we fail initialization, but can\u0027t call the normal path because it includes the thread safe check for a poll group which hasn\u0027t been assigned yet. So we can\u0027t know if we are disconnecting from a different thread and we just don\u0027t have the updated value for the group or if we are disconnecting from the initialization path. We are going to have to keep two paths. But at least this way, we avoid any contention after the qpair is initialized.",
      "parentUuid": "92f83225_1aa7c21a",
      "revId": "e37b78472750b64a66dc68c70eddad85595864c3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    }
  ]
}