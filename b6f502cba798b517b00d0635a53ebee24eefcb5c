{
  "comments": [
    {
      "key": {
        "uuid": "09833406_bf64af48",
        "filename": "include/spdk/nvmf.h",
        "patchSetId": 5
      },
      "lineNbr": 481,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2018-04-16T18:30:06Z",
      "side": 1,
      "message": "Let\u0027s keep it to just one call - spdk_nvmf_subsystem_add_ns. The config file parsing can give it a callback that does nothing and not wait for it to be called to continue. The config file parsing has major issues like that all over where it kicks off an asynchronous operation but doesn\u0027t wait for it to complete. That\u0027s fine for now - the whole config file parsing is on the list of things to be rewritten.",
      "revId": "b6f502cba798b517b00d0635a53ebee24eefcb5c",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "035d6bc4_e8ca8c08",
        "filename": "include/spdk/nvmf.h",
        "patchSetId": 5
      },
      "lineNbr": 481,
      "author": {
        "id": 1011223
      },
      "writtenOn": "2018-04-17T00:02:37Z",
      "side": 1,
      "message": "My issue doesn\u0027t actually have to do with the callback. The NVMe_oF target parses the configuration file before it allocates the poll groups, so any call to add_ns was failing because the call to subsystem_modify_on_pg was broken. However, I can change the state machine for starting the NVMe-oF target to split config file parsing in half and parse the subsystems after the poll groups have been initialized.\nSo something like this: spdk_nvmf_parse_nvmf_tgt-\u003einitialize_tgts-\u003espdk_nvmf_parse_subsystems.\nThat will enable us to drop the second function from the API.",
      "parentUuid": "09833406_bf64af48",
      "revId": "b6f502cba798b517b00d0635a53ebee24eefcb5c",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b90a5be5_f2463d92",
        "filename": "include/spdk/nvmf.h",
        "patchSetId": 5
      },
      "lineNbr": 481,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2018-04-17T17:31:12Z",
      "side": 1,
      "message": "Why was subsystem_modify_on_pg getting called if there aren\u0027t any poll groups created yet? spdk_for_each_channel should only be calling subsystem_modify_on_pg on threads for which a poll group exists. If there aren\u0027t any, it will just call completion callback immediately. Is spdk_for_each_channel broken or something?",
      "parentUuid": "035d6bc4_e8ca8c08",
      "revId": "b6f502cba798b517b00d0635a53ebee24eefcb5c",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0c651b94_8c34da05",
        "filename": "include/spdk/nvmf.h",
        "patchSetId": 5
      },
      "lineNbr": 481,
      "author": {
        "id": 1011223
      },
      "writtenOn": "2018-04-17T19:55:24Z",
      "side": 1,
      "message": "You\u0027re absolutely right. I must have misinterpreted a seg fault I was getting early on in development to be coming from that function. I have re-based without the middle patch.",
      "parentUuid": "b90a5be5_f2463d92",
      "revId": "b6f502cba798b517b00d0635a53ebee24eefcb5c",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    }
  ]
}