{
  "comments": [
    {
      "key": {
        "uuid": "b821c00b_fa6d576d",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 1
      },
      "lineNbr": 537,
      "author": {
        "id": 1015368
      },
      "writtenOn": "2019-02-13T16:03:58Z",
      "side": 1,
      "message": "I think this comment can be misleading - it\u0027s not the entry\u0027s LBA that can be updated (as in: entry-\u003elba), but the l2p pointed by the entry\u0027s LBA. I suggest to rephrase it like so:\n\"If the l2p wasn\u0027t updated and still points at the entry, fill it with...\".",
      "range": {
        "startLine": 537,
        "startChar": 4,
        "endLine": 537,
        "endChar": 39
      },
      "revId": "039fbbcd870189510f92d5e1b6dcac95db9f93b8",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a94becd6_10b3645f",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 1
      },
      "lineNbr": 537,
      "author": {
        "id": 1015344
      },
      "writtenOn": "2019-02-13T16:28:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b821c00b_fa6d576d",
      "range": {
        "startLine": 537,
        "startChar": 4,
        "endLine": 537,
        "endChar": 39
      },
      "revId": "039fbbcd870189510f92d5e1b6dcac95db9f93b8",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "85563df9_ccd1d7be",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 1
      },
      "lineNbr": 1070,
      "author": {
        "id": 1015368
      },
      "writtenOn": "2019-02-13T16:03:58Z",
      "side": 1,
      "message": "Similar here: I suggest rephrasing it like so: \"If the l2p was updated in the meantime, don\u0027t update band\u0027s metadata.\"",
      "range": {
        "startLine": 1069,
        "startChar": 6,
        "endLine": 1070,
        "endChar": 25
      },
      "revId": "039fbbcd870189510f92d5e1b6dcac95db9f93b8",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a1ffea53_64c44d98",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 1
      },
      "lineNbr": 1070,
      "author": {
        "id": 1015344
      },
      "writtenOn": "2019-02-13T16:28:46Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "85563df9_ccd1d7be",
      "range": {
        "startLine": 1069,
        "startChar": 6,
        "endLine": 1070,
        "endChar": 25
      },
      "revId": "039fbbcd870189510f92d5e1b6dcac95db9f93b8",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e250f2f8_58c785c5",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 1
      },
      "lineNbr": 1071,
      "author": {
        "id": 1015368
      },
      "writtenOn": "2019-02-13T16:03:58Z",
      "side": 1,
      "message": "Before doing such comparison, you should make sure that ftl_ppa_cached(prev_ppa) \u003d\u003d true.",
      "range": {
        "startLine": 1071,
        "startChar": 7,
        "endLine": 1071,
        "endChar": 36
      },
      "revId": "039fbbcd870189510f92d5e1b6dcac95db9f93b8",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "fdd0dd47_b3b5c87a",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 1
      },
      "lineNbr": 1071,
      "author": {
        "id": 1015344
      },
      "writtenOn": "2019-02-13T16:08:23Z",
      "side": 1,
      "message": "I can add assert for this. At this point ftl_ltp_get must return cached value.",
      "parentUuid": "e250f2f8_58c785c5",
      "range": {
        "startLine": 1071,
        "startChar": 7,
        "endLine": 1071,
        "endChar": 36
      },
      "revId": "039fbbcd870189510f92d5e1b6dcac95db9f93b8",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "366b6fd6_39526cc5",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 1
      },
      "lineNbr": 1071,
      "author": {
        "id": 1015368
      },
      "writtenOn": "2019-02-14T08:57:56Z",
      "side": 1,
      "message": "I disagree - it is indeed a rare case, but it\u0027s definitely possible. Consider the following scenario:\n1. User writes LBA x - it goes through ftl_rwb_fill, acquires rwb entry and pushes it (but the rwb batch is not full).\n2. User writes to a different address, it acquires an entry from the same batch, but before pushing it, goes the thread sleeps.\n3. Another thread fills up the remaining entries in the batch, but the batch remains not full (as the entry in 2 wasn\u0027t pushed).\n4. User writes LBA x again, it acquires an entry from another batch, which becomes full and is submitted, and then finally completed.\n5. The entry is reused, so the L2P is updated with an on-disk PPA address.\n6. The thread wakes up, pushes the entry and the bath, and we end up here checking the prev_ppa.offset \u003d\u003d entry-\u003epos with prev_ppa not pointing at the cache.",
      "parentUuid": "fdd0dd47_b3b5c87a",
      "range": {
        "startLine": 1071,
        "startChar": 7,
        "endLine": 1071,
        "endChar": 36
      },
      "revId": "039fbbcd870189510f92d5e1b6dcac95db9f93b8",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c3efa50f_089182cc",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 1
      },
      "lineNbr": 1071,
      "author": {
        "id": 1015344
      },
      "writtenOn": "2019-02-14T09:39:18Z",
      "side": 1,
      "message": "Yes, it make sense - this thread should sleep for a long time but this is possible. Wondering if we don\u0027t have another issues with such scenario - for sure we could have data corruption on restore with previous implementation in such scenario.",
      "parentUuid": "366b6fd6_39526cc5",
      "range": {
        "startLine": 1071,
        "startChar": 7,
        "endLine": 1071,
        "endChar": 36
      },
      "revId": "039fbbcd870189510f92d5e1b6dcac95db9f93b8",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    }
  ]
}