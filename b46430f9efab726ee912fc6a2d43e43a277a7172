{
  "comments": [
    {
      "key": {
        "uuid": "1422389b_99111f3c",
        "filename": "lib/nbd/nbd.c",
        "patchSetId": 3
      },
      "lineNbr": 114,
      "author": {
        "id": 1011204
      },
      "writtenOn": "2017-11-29T05:12:10Z",
      "side": 1,
      "message": "should move the macro definition on top of the source file.",
      "revId": "b46430f9efab726ee912fc6a2d43e43a277a7172",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6933e1b4_9cdd270d",
        "filename": "lib/nbd/nbd.c",
        "patchSetId": 3
      },
      "lineNbr": 117,
      "author": {
        "id": 1011204
      },
      "writtenOn": "2017-11-29T05:12:10Z",
      "side": 1,
      "message": "rename to task_pool maybe better.",
      "revId": "b46430f9efab726ee912fc6a2d43e43a277a7172",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8dd91e29_967d5b84",
        "filename": "lib/nbd/nbd.c",
        "patchSetId": 3
      },
      "lineNbr": 120,
      "author": {
        "id": 1011204
      },
      "writtenOn": "2017-11-29T05:12:10Z",
      "side": 1,
      "message": "same here.",
      "revId": "b46430f9efab726ee912fc6a2d43e43a277a7172",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "94aae911_56a610b3",
        "filename": "lib/nbd/nbd.c",
        "patchSetId": 3
      },
      "lineNbr": 347,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2017-11-29T12:12:21Z",
      "side": 1,
      "message": "Aggregating these code into a function and place it beside  nbd_io_idle_obtain, nbd_io_done_obtain, and nbd_io_put_back will be good.",
      "range": {
        "startLine": 345,
        "startChar": 3,
        "endLine": 347,
        "endChar": 52
      },
      "revId": "b46430f9efab726ee912fc6a2d43e43a277a7172",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f8fb38cc_cb2fe0c3",
        "filename": "lib/nbd/nbd.c",
        "patchSetId": 3
      },
      "lineNbr": 347,
      "author": {
        "id": 1011712
      },
      "writtenOn": "2017-11-29T14:00:54Z",
      "side": 1,
      "message": "at start, I was also thinking to aggregate these code into inline functions to make it looks more standard. But this would generate several simple and short functions which might be tedious. so just chose to use these code directly with some annotation",
      "parentUuid": "94aae911_56a610b3",
      "range": {
        "startLine": 345,
        "startChar": 3,
        "endLine": 347,
        "endChar": 52
      },
      "revId": "b46430f9efab726ee912fc6a2d43e43a277a7172",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "72683772_3993be37",
        "filename": "lib/nbd/nbd.c",
        "patchSetId": 3
      },
      "lineNbr": 347,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2017-11-29T23:45:04Z",
      "side": 1,
      "message": "Your comment makes sense to me. But please improve this patch gradually to make easier to understand.\n\nFor example this function receives not only request but also payload. However this function is named as nbd_io_recv_req.",
      "parentUuid": "f8fb38cc_cb2fe0c3",
      "range": {
        "startLine": 345,
        "startChar": 3,
        "endLine": 347,
        "endChar": 52
      },
      "revId": "b46430f9efab726ee912fc6a2d43e43a277a7172",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "146d4bb6_89619677",
        "filename": "lib/nbd/nbd.c",
        "patchSetId": 3
      },
      "lineNbr": 376,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2017-11-29T12:12:21Z",
      "side": 1,
      "message": "Same as above",
      "range": {
        "startLine": 374,
        "startChar": 0,
        "endLine": 376,
        "endChar": 51
      },
      "revId": "b46430f9efab726ee912fc6a2d43e43a277a7172",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "70ed9771_dc1cc7c9",
        "filename": "lib/nbd/nbd.c",
        "patchSetId": 3
      },
      "lineNbr": 460,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2017-11-29T12:12:21Z",
      "side": 1,
      "message": "Same as above.",
      "range": {
        "startLine": 458,
        "startChar": 0,
        "endLine": 460,
        "endChar": 51
      },
      "revId": "b46430f9efab726ee912fc6a2d43e43a277a7172",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e2ebda70_0ced8aa9",
        "filename": "lib/nbd/nbd.c",
        "patchSetId": 3
      },
      "lineNbr": 472,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2017-11-29T12:12:21Z",
      "side": 1,
      "message": "change to _nbd_submit_bdev_io or merging to the following may be better.",
      "range": {
        "startLine": 472,
        "startChar": 0,
        "endLine": 472,
        "endChar": 18
      },
      "revId": "b46430f9efab726ee912fc6a2d43e43a277a7172",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e81c801f_a3c14534",
        "filename": "lib/nbd/nbd.c",
        "patchSetId": 3
      },
      "lineNbr": 505,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2017-11-29T12:12:21Z",
      "side": 1,
      "message": "Previously this function prepared for submission (allocated the buffer for payload) but now just set  io-\u003etype based on io-\u003ereq.type. Hence the following change may be reasonable:\n process_request -\u003e nbd_bdev_submit_io\n nbd_bdev_submit_io -\u003e _nbd_bdev_submit_io\n\nOr aggregate two functions into one nbd_bdev_submit_io",
      "range": {
        "startLine": 505,
        "startChar": 0,
        "endLine": 505,
        "endChar": 15
      },
      "revId": "b46430f9efab726ee912fc6a2d43e43a277a7172",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5686df93_f214650d",
        "filename": "lib/nbd/nbd.c",
        "patchSetId": 3
      },
      "lineNbr": 505,
      "author": {
        "id": 1011712
      },
      "writtenOn": "2017-11-29T14:00:54Z",
      "side": 1,
      "message": "it is reasonable. thanks for this suggestion.",
      "parentUuid": "e81c801f_a3c14534",
      "range": {
        "startLine": 505,
        "startChar": 0,
        "endLine": 505,
        "endChar": 15
      },
      "revId": "b46430f9efab726ee912fc6a2d43e43a277a7172",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c4f1119d_590cfd5b",
        "filename": "lib/nbd/nbd.c",
        "patchSetId": 3
      },
      "lineNbr": 554,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2017-11-29T12:12:21Z",
      "side": 1,
      "message": "I think this means that submission of a  bdev IO was done and receiving the next request will start. You should indicate this more clearly.",
      "range": {
        "startLine": 553,
        "startChar": 2,
        "endLine": 554,
        "endChar": 23
      },
      "revId": "b46430f9efab726ee912fc6a2d43e43a277a7172",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4800d2e5_37074922",
        "filename": "lib/nbd/nbd.c",
        "patchSetId": 3
      },
      "lineNbr": 554,
      "author": {
        "id": 1011712
      },
      "writtenOn": "2017-11-29T14:00:54Z",
      "side": 1,
      "message": "Yes, I should add some annotation to indicate it more clearly",
      "parentUuid": "c4f1119d_590cfd5b",
      "range": {
        "startLine": 553,
        "startChar": 2,
        "endLine": 554,
        "endChar": 23
      },
      "revId": "b46430f9efab726ee912fc6a2d43e43a277a7172",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0581c82d_5f79c72b",
        "filename": "lib/nbd/nbd.c",
        "patchSetId": 3
      },
      "lineNbr": 555,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2017-11-29T08:11:33Z",
      "side": 1,
      "message": "Thanks for your feedback, I could understand better than before.\n\nI think this part is for reading request\u0026payload, issuing bdev IO, and handle completion of bdev IO.\n\nThe following may make your code better \n- create a loop to do batch process and\n- if the poller do not get any data from socket or loop count exceeds any limit, the poller should exit from loop.\n\nLooking into spdk_iscsi_conn_handle_incominng_pdus() in lib/iscsi may be helpful for you.",
      "range": {
        "startLine": 541,
        "startChar": 0,
        "endLine": 555,
        "endChar": 2
      },
      "revId": "b46430f9efab726ee912fc6a2d43e43a277a7172",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0702f093_c7db7bf1",
        "filename": "lib/nbd/nbd.c",
        "patchSetId": 3
      },
      "lineNbr": 555,
      "author": {
        "id": 1011712
      },
      "writtenOn": "2017-11-29T09:37:37Z",
      "side": 1,
      "message": "yes, adding batch process is more efficient.",
      "parentUuid": "0581c82d_5f79c72b",
      "range": {
        "startLine": 541,
        "startChar": 0,
        "endLine": 555,
        "endChar": 2
      },
      "revId": "b46430f9efab726ee912fc6a2d43e43a277a7172",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "53050d2f_6ea6d091",
        "filename": "lib/nbd/nbd.c",
        "patchSetId": 3
      },
      "lineNbr": 570,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2017-11-29T08:11:33Z",
      "side": 1,
      "message": "Same as above.",
      "range": {
        "startLine": 557,
        "startChar": 0,
        "endLine": 570,
        "endChar": 23
      },
      "revId": "b46430f9efab726ee912fc6a2d43e43a277a7172",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bb2cda0f_4f60718f",
        "filename": "lib/nbd/nbd.c",
        "patchSetId": 3
      },
      "lineNbr": 570,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2017-11-29T12:12:21Z",
      "side": 1,
      "message": "As same as the above, this means that reply of a IO was done and checking if next reply is coming. You should indicate this more clearly.\n\nIf my understanding is not correct, please revise that.",
      "range": {
        "startLine": 569,
        "startChar": 2,
        "endLine": 570,
        "endChar": 23
      },
      "revId": "b46430f9efab726ee912fc6a2d43e43a277a7172",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2db1db05_b85ea017",
        "filename": "lib/nbd/nbd.c",
        "patchSetId": 3
      },
      "lineNbr": 617,
      "author": {
        "id": 1011204
      },
      "writtenOn": "2017-11-29T05:12:10Z",
      "side": 1,
      "message": "Need error check here for NULL pointer, maybe spdk_nbd_alloc is better, and change _nbd_stop to spdk_nbd_free?",
      "revId": "b46430f9efab726ee912fc6a2d43e43a277a7172",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c68e043d_ea646bed",
        "filename": "lib/nbd/nbd.c",
        "patchSetId": 3
      },
      "lineNbr": 617,
      "author": {
        "id": 1011712
      },
      "writtenOn": "2017-11-29T09:37:37Z",
      "side": 1,
      "message": "_nbd-stop needs to close iochannel, bdev and kinds of fd. In order to stay the same with spdk_nbd_alloc, extracting mempool free and free(nbd) to be spdk_nbd_free is practicable.",
      "parentUuid": "2db1db05_b85ea017",
      "revId": "b46430f9efab726ee912fc6a2d43e43a277a7172",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    }
  ]
}