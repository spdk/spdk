{
  "comments": [
    {
      "key": {
        "uuid": "99f0dfad_cd0527bc",
        "filename": "lib/bdev/bdev.c",
        "patchSetId": 1
      },
      "lineNbr": 3194,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2018-10-09T21:04:52Z",
      "side": 1,
      "message": "Do you see a case where claim_module is not set to NULL?  spdk_bdev_module_release_bdev() already sets it to NULL.  I\u0027d like to know more why that NULL assignment doesn\u0027t work.",
      "revId": "3d3bba95a7b86098e831c737e619eac4a864bba9",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0bde0232_0acda1c2",
        "filename": "lib/bdev/bdev.c",
        "patchSetId": 1
      },
      "lineNbr": 3194,
      "author": {
        "id": 1014226
      },
      "writtenOn": "2018-10-10T14:53:12Z",
      "side": 1,
      "message": "I am looping on:\n- start reactor\n- construct subsystem\n- create bdevs\n- map to subsystem\n- IO\n- unmap from subsystem\n- remove bdevs\n- delete subsystem\n- stop reactor\n\ncrashed on 2nd iteration. I\u0027ll check why spdk_bdev_module_release_bdev didn\u0027t do the trick",
      "parentUuid": "99f0dfad_cd0527bc",
      "revId": "3d3bba95a7b86098e831c737e619eac4a864bba9",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "49f0e7cf_f8656bc3",
        "filename": "lib/bdev/bdev.c",
        "patchSetId": 1
      },
      "lineNbr": 3194,
      "author": {
        "id": 1014226
      },
      "writtenOn": "2018-10-11T07:34:37Z",
      "side": 1,
      "message": "I found the problem, for each bdev, nvmf_rpc_subsystem_add_ns is claiming the bdev, and nvmf_rpc_subsystem_remove_ns is releasing it, so no problem.\nThe thing is, I am ebedding the bdev in my control structues, so the memory contents are not guaranteed to be zeroed. I can memzero, but it seems cleaner that bdev does not assume it.\nBTW, for other spdk bdev modules (e.g virtio), I can see that calloc is used, so should be exposed to the same issue.\n\nWDYT?",
      "parentUuid": "0bde0232_0acda1c2",
      "revId": "3d3bba95a7b86098e831c737e619eac4a864bba9",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1adb0031_44e98c82",
        "filename": "lib/bdev/bdev.c",
        "patchSetId": 1
      },
      "lineNbr": 3195,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2018-10-09T21:04:52Z",
      "side": 1,
      "message": "I think we should unregister the poller when the bdev is shutdown/destroyed instead.  spdk_poller_unregister will then automatically set this to NULL.",
      "revId": "3d3bba95a7b86098e831c737e619eac4a864bba9",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8369b0e0_b05f57dc",
        "filename": "lib/bdev/bdev.c",
        "patchSetId": 1
      },
      "lineNbr": 3195,
      "author": {
        "id": 1014226
      },
      "writtenOn": "2018-10-11T07:37:57Z",
      "side": 1,
      "message": "This is similar to the issue above, qd_poller is set to NULL in spdk_poller_unregister, but I am using a new bdev, so I don\u0027t think there should be any assumptions on the contents of ndev-\u003einternal.",
      "parentUuid": "1adb0031_44e98c82",
      "revId": "3d3bba95a7b86098e831c737e619eac4a864bba9",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2ccca6db_1f654e76",
        "filename": "lib/bdev/bdev.c",
        "patchSetId": 1
      },
      "lineNbr": 3197,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2018-10-09T21:04:52Z",
      "side": 1,
      "message": "base_bdevs and base_bdevs_cnt were removed a couple of months ago.",
      "revId": "3d3bba95a7b86098e831c737e619eac4a864bba9",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2c0918b0_b53d0ffb",
        "filename": "lib/bdev/bdev.c",
        "patchSetId": 1
      },
      "lineNbr": 3246,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2018-10-09T21:04:52Z",
      "side": 1,
      "message": "Oh - you set this to NULL here.  Can we delete the previous patch in this series then?",
      "revId": "3d3bba95a7b86098e831c737e619eac4a864bba9",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    }
  ]
}