{
  "comments": [
    {
      "key": {
        "uuid": "ffa2b527_c8be9985",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 48
      },
      "lineNbr": 334,
      "author": {
        "id": 1011262
      },
      "writtenOn": "2018-07-24T08:00:45Z",
      "side": 1,
      "message": "I think we can remove \"_cb\" from function name.",
      "range": {
        "startLine": 334,
        "startChar": 22,
        "endLine": 334,
        "endChar": 25
      },
      "revId": "f4c25216337d205a17bffb5881f7488a7af3aa8b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "70063941_5565a3b8",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 48
      },
      "lineNbr": 334,
      "author": {
        "id": 1011221
      },
      "writtenOn": "2018-07-24T14:09:37Z",
      "side": 1,
      "message": "This serves as callback for all vbdev_lvol_destroy() calls too.",
      "parentUuid": "ffa2b527_c8be9985",
      "range": {
        "startLine": 334,
        "startChar": 22,
        "endLine": 334,
        "endChar": 25
      },
      "revId": "f4c25216337d205a17bffb5881f7488a7af3aa8b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b36a680b_8f0b6d68",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 48
      },
      "lineNbr": 340,
      "author": {
        "id": 1011262
      },
      "writtenOn": "2018-07-24T08:00:45Z",
      "side": 1,
      "message": "In case of error we could save lvolerrno and return it through lvs-\u003edestruct_req-\u003ecb_fn in lines 345 and 358.",
      "range": {
        "startLine": 340,
        "startChar": 1,
        "endLine": 340,
        "endChar": 22
      },
      "revId": "f4c25216337d205a17bffb5881f7488a7af3aa8b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "21b6a6d3_2fa12cf9",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 48
      },
      "lineNbr": 340,
      "author": {
        "id": 1011221
      },
      "writtenOn": "2018-07-24T14:09:37Z",
      "side": 1,
      "message": "That is tricky and possibly confusing. Please remember that there are multiple lvols being removed here. I don\u0027t think we want to keep track of every single one - especially if lvol destroy went half way through.\nOn the other hand returning just one, might be confusing in similar way. Since it might suggest whole deletion did not succeed.\n\nGeneral approach we took so far is:\n- return error if deletion is not possible, but state is untouched\n- proceed with deletion regardless of errors, trying to keep deletion path with as few failure points as possible\n\nI\u0027d think only reporting in as debug log is enough for this case. Please let me know if you happen to be of other opinion.\n\n\nAs for returning in line 358, there is something very wrong if we get to that point. There would be no way to ever delete lvs or lvols. \u0027while\u0027 on line 349 goes over all remaining lvols and check if any are deletable. If none are, that means somehow they depend on each other.\nI think in next patch set I\u0027ll put assert there for this reason.",
      "parentUuid": "b36a680b_8f0b6d68",
      "range": {
        "startLine": 340,
        "startChar": 1,
        "endLine": 340,
        "endChar": 22
      },
      "revId": "f4c25216337d205a17bffb5881f7488a7af3aa8b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "55d8b427_60fe1e40",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 48
      },
      "lineNbr": 345,
      "author": {
        "id": 1011262
      },
      "writtenOn": "2018-07-24T08:00:45Z",
      "side": 1,
      "message": "With current approach we can call spdk_lvs_destroy here instead of in _spdk_lvol_delete_blob_cb function - this way we will simplify our code a lot.",
      "range": {
        "startLine": 345,
        "startChar": 2,
        "endLine": 345,
        "endChar": 9
      },
      "revId": "f4c25216337d205a17bffb5881f7488a7af3aa8b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "abf4744a_ea6b3d66",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 48
      },
      "lineNbr": 345,
      "author": {
        "id": 1011262
      },
      "writtenOn": "2018-07-24T08:06:05Z",
      "side": 1,
      "message": "And it that case we could probably remove destruct_req - this would require a some changes in functions arguments.",
      "parentUuid": "55d8b427_60fe1e40",
      "range": {
        "startLine": 345,
        "startChar": 2,
        "endLine": 345,
        "endChar": 9
      },
      "revId": "f4c25216337d205a17bffb5881f7488a7af3aa8b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6949f785_679de355",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 48
      },
      "lineNbr": 345,
      "author": {
        "id": 1011221
      },
      "writtenOn": "2018-07-24T14:09:37Z",
      "side": 1,
      "message": "You are right, just didn\u0027t want to pack too much changes into one patch. Please see following patch:https://review.gerrithub.io/#/c/spdk/spdk/+/420285/",
      "parentUuid": "abf4744a_ea6b3d66",
      "range": {
        "startLine": 345,
        "startChar": 2,
        "endLine": 345,
        "endChar": 9
      },
      "revId": "f4c25216337d205a17bffb5881f7488a7af3aa8b",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    }
  ]
}