{
  "comments": [
    {
      "key": {
        "uuid": "6d543f78_e9bcc13a",
        "filename": "lib/nvme/nvme_ctrlr.c",
        "patchSetId": 2
      },
      "lineNbr": 855,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2018-09-07T17:27:48Z",
      "side": 1,
      "message": "I\u0027d move this set state call into the state machine right below nvme_ctrlr_identify. For the callbacks you\u0027ll have to call nvme_ctrl_set_state outside of the main state machine function, but where we can we should keep the calls to transition states within the state machine function for clarity.\n\nIn fact, this function is probably small enough that you can just inline the whole thing under NVME_CTRLR_STATE_IDENTIFY.",
      "revId": "9e467cb5a6045296b8c2cf15db3844c2d63526a3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6c70483f_e95e16c7",
        "filename": "lib/nvme/nvme_ctrlr.c",
        "patchSetId": 2
      },
      "lineNbr": 855,
      "author": {
        "id": 1011204
      },
      "writtenOn": "2018-09-10T04:12:08Z",
      "side": 1,
      "message": "sounds good.",
      "parentUuid": "6d543f78_e9bcc13a",
      "revId": "9e467cb5a6045296b8c2cf15db3844c2d63526a3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a08df0f1_343dc7f1",
        "filename": "lib/nvme/nvme_ctrlr.c",
        "patchSetId": 2
      },
      "lineNbr": 1777,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2018-09-07T17:27:48Z",
      "side": 1,
      "message": "This case should go right under NVME_CTRLR_STATE_IDENTIFY, so the state machine can be read from top to bottom in order of how the states progress.",
      "revId": "9e467cb5a6045296b8c2cf15db3844c2d63526a3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f0ffdff6_a60db544",
        "filename": "lib/nvme/nvme_ctrlr.c",
        "patchSetId": 2
      },
      "lineNbr": 1777,
      "author": {
        "id": 1011204
      },
      "writtenOn": "2018-09-10T04:12:08Z",
      "side": 1,
      "message": "There are several other WAIT_FOR_* states also poll the completion queue here, so we can use:\ncase NVME_CTRLR_STATE_WAIT_FOR_IDENTIFY:\ncase NVME_CTRLR_STATE_WAIT_FOR_AER:\netc... at the same block.",
      "parentUuid": "a08df0f1_343dc7f1",
      "revId": "9e467cb5a6045296b8c2cf15db3844c2d63526a3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "eb1cc7a4_28cacc6c",
        "filename": "lib/nvme/nvme_ctrlr.c",
        "patchSetId": 2
      },
      "lineNbr": 1777,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2018-09-10T20:57:15Z",
      "side": 1,
      "message": "These could definitely all fall through to the same spdk_nvme_qpair_process_completions call to avoid repeating the code. However, my gut tells me that it\u0027s better in this case to be more verbose and write out the state machine in the order the states will occur in, repeating these calls throughout. I\u0027d like to see what everyone else thinks is most readable and/or understandable here.",
      "parentUuid": "f0ffdff6_a60db544",
      "revId": "9e467cb5a6045296b8c2cf15db3844c2d63526a3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f5a7f42a_c0e314ac",
        "filename": "lib/nvme/nvme_ctrlr.c",
        "patchSetId": 2
      },
      "lineNbr": 1777,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2018-09-10T21:13:19Z",
      "side": 1,
      "message": "I think putting them in order is best for now.  Once this is all done, we can reassess and combine them.",
      "parentUuid": "eb1cc7a4_28cacc6c",
      "revId": "9e467cb5a6045296b8c2cf15db3844c2d63526a3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8c0a5278_5535db22",
        "filename": "test/unit/lib/nvme/nvme_ctrlr.c/nvme_ctrlr_ut.c",
        "patchSetId": 2
      },
      "lineNbr": 482,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2018-09-07T17:27:48Z",
      "side": 1,
      "message": "nvme_ctrlr_cmd_identify is mocked up above and completes/calls its callback immediately which will jump the state machine into the next state. I don\u0027t think you need this ctrlr.state++ to progress.",
      "revId": "9e467cb5a6045296b8c2cf15db3844c2d63526a3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "04ec084e_b6171e3d",
        "filename": "test/unit/lib/nvme/nvme_ctrlr.c/nvme_ctrlr_ut.c",
        "patchSetId": 2
      },
      "lineNbr": 484,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2018-09-07T17:27:48Z",
      "side": 1,
      "message": "Extra space before ++",
      "revId": "9e467cb5a6045296b8c2cf15db3844c2d63526a3",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    }
  ]
}