{
  "comments": [
    {
      "key": {
        "uuid": "dafd92d6_feb56d33",
        "filename": "lib/nvmf/rdma.c",
        "patchSetId": 4
      },
      "lineNbr": 62,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2019-01-22T20:09:52Z",
      "side": 1,
      "message": "I think it would help to have the following #define:\n\n#define MAX_WR_PER_QP(queue_depth) (queue_depth * 3 + 2)\n\nThen use that anywhere you are currently writing out the formula.",
      "revId": "a6b4385c909bcc67136bf44a97297c349f540391",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "27137746_2a247eac",
        "filename": "lib/nvmf/rdma.c",
        "patchSetId": 4
      },
      "lineNbr": 62,
      "author": {
        "id": 1011712
      },
      "writtenOn": "2019-01-23T03:03:24Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "dafd92d6_feb56d33",
      "revId": "a6b4385c909bcc67136bf44a97297c349f540391",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9acf6462_f5152060",
        "filename": "lib/nvmf/rdma.c",
        "patchSetId": 4
      },
      "lineNbr": 336,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2019-01-22T20:09:52Z",
      "side": 1,
      "message": "Rename \u0027cur_num_cqe\u0027 to just \u0027num_cqe\u0027",
      "revId": "a6b4385c909bcc67136bf44a97297c349f540391",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "040840f2_8f91021d",
        "filename": "lib/nvmf/rdma.c",
        "patchSetId": 4
      },
      "lineNbr": 336,
      "author": {
        "id": 1011712
      },
      "writtenOn": "2019-01-23T03:03:24Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "9acf6462_f5152060",
      "revId": "a6b4385c909bcc67136bf44a97297c349f540391",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "18b32296_d47f6bfe",
        "filename": "lib/nvmf/rdma.c",
        "patchSetId": 4
      },
      "lineNbr": 337,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2019-01-22T20:09:52Z",
      "side": 1,
      "message": "Rename \u0027cur_max_wr\u0027 to \u0027required_num_wr\u0027.",
      "revId": "a6b4385c909bcc67136bf44a97297c349f540391",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0376babf_d620dbbe",
        "filename": "lib/nvmf/rdma.c",
        "patchSetId": 4
      },
      "lineNbr": 337,
      "author": {
        "id": 1011712
      },
      "writtenOn": "2019-01-23T03:03:24Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "18b32296_d47f6bfe",
      "revId": "a6b4385c909bcc67136bf44a97297c349f540391",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "34a7fc34_9f2c0f4a",
        "filename": "lib/nvmf/rdma.c",
        "patchSetId": 4
      },
      "lineNbr": 719,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2019-01-22T20:09:52Z",
      "side": 1,
      "message": "I don\u0027t think you need a while loop here for a few reasons. First, cur_num_cqe is always a multiple of the max wrs per qp, so doubling it one time always guarantees that this condition is true on the next pass. But even beyond that, you can just calculate how big the cq would need to be up front and do a single resize. For example:\n\nnum_cqe \u003d spdk_max(rpoller-\u003ecur_num_cqe * 2, rqpair-\u003ecur_max_wr + rqpair-\u003emax_queue_depth * 3 + 2);\nnum_cqe \u003d spdk_min(num_cqe, device-\u003eattr.max_cqe);\n\nResizing the cq to num_cqe above will always satisfy the condition on the first try.",
      "revId": "a6b4385c909bcc67136bf44a97297c349f540391",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2565ab71_9976b8cf",
        "filename": "lib/nvmf/rdma.c",
        "patchSetId": 4
      },
      "lineNbr": 719,
      "author": {
        "id": 1011712
      },
      "writtenOn": "2019-01-23T03:03:24Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "34a7fc34_9f2c0f4a",
      "revId": "a6b4385c909bcc67136bf44a97297c349f540391",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "744a1506_26ec0a29",
        "filename": "lib/nvmf/rdma.c",
        "patchSetId": 4
      },
      "lineNbr": 721,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2019-01-22T20:09:52Z",
      "side": 1,
      "message": "This actually needs to be an error.",
      "revId": "a6b4385c909bcc67136bf44a97297c349f540391",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b7890106_61f6e3ae",
        "filename": "lib/nvmf/rdma.c",
        "patchSetId": 4
      },
      "lineNbr": 721,
      "author": {
        "id": 1011712
      },
      "writtenOn": "2019-01-23T03:03:24Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "744a1506_26ec0a29",
      "revId": "a6b4385c909bcc67136bf44a97297c349f540391",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2dc28e63_b4b74583",
        "filename": "lib/nvmf/rdma.c",
        "patchSetId": 4
      },
      "lineNbr": 2422,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2019-01-22T20:09:52Z",
      "side": 1,
      "message": "We should probably check that the default is greater than or equal to the MAX_WR_PER_QP for a single queue, because less than that and it wouldn\u0027t function correctly.",
      "revId": "a6b4385c909bcc67136bf44a97297c349f540391",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7d785466_23cf043d",
        "filename": "lib/nvmf/rdma.c",
        "patchSetId": 4
      },
      "lineNbr": 2422,
      "author": {
        "id": 1011712
      },
      "writtenOn": "2019-01-23T03:03:24Z",
      "side": 1,
      "message": "Eh, since the queue-depth for a single queue depends on several conditions like rdma config, rdma device limitation and host setting,  so queue-depth for each QP is not exactly same. And we don\u0027t know it here when we create the CQ.",
      "parentUuid": "2dc28e63_b4b74583",
      "revId": "a6b4385c909bcc67136bf44a97297c349f540391",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    }
  ]
}