{
  "comments": [
    {
      "key": {
        "uuid": "c23aba95_3006ce6e",
        "filename": "lib/nvmf/ctrlr_bdev.c",
        "patchSetId": 4
      },
      "lineNbr": 543,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2019-01-07T23:50:20Z",
      "side": 1,
      "message": "you can remove this?",
      "range": {
        "startLine": 543,
        "startChar": 1,
        "endLine": 543,
        "endChar": 21
      },
      "revId": "e14f90a28cc762be1c9a33d605e643a1007aac87",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "96acf0f2_1599a9ee",
        "filename": "lib/nvmf/ctrlr_bdev.c",
        "patchSetId": 4
      },
      "lineNbr": 543,
      "author": {
        "id": 1011204
      },
      "writtenOn": "2019-01-08T05:43:29Z",
      "side": 1,
      "message": "good catch.",
      "parentUuid": "c23aba95_3006ce6e",
      "range": {
        "startLine": 543,
        "startChar": 1,
        "endLine": 543,
        "endChar": 21
      },
      "revId": "e14f90a28cc762be1c9a33d605e643a1007aac87",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2cce80b1_6b8ca325",
        "filename": "lib/nvmf/ctrlr_bdev.c",
        "patchSetId": 4
      },
      "lineNbr": 545,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2019-01-07T23:50:20Z",
      "side": 1,
      "message": "if you use 0 as failure and 1 as success, will you use boolean instead?",
      "range": {
        "startLine": 545,
        "startChar": 9,
        "endLine": 545,
        "endChar": 10
      },
      "revId": "e14f90a28cc762be1c9a33d605e643a1007aac87",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fd37a83f_a65c12d5",
        "filename": "lib/nvmf/ctrlr_bdev.c",
        "patchSetId": 4
      },
      "lineNbr": 545,
      "author": {
        "id": 1011204
      },
      "writtenOn": "2019-01-08T05:43:29Z",
      "side": 1,
      "message": "yeah, will change it.",
      "parentUuid": "2cce80b1_6b8ca325",
      "range": {
        "startLine": 545,
        "startChar": 9,
        "endLine": 545,
        "endChar": 10
      },
      "revId": "e14f90a28cc762be1c9a33d605e643a1007aac87",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "8387a1cd_cab6d18f",
        "filename": "lib/nvmf/ctrlr_bdev.c",
        "patchSetId": 4
      },
      "lineNbr": 557,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2019-01-07T23:50:20Z",
      "side": 1,
      "message": "-\u003e true ?",
      "range": {
        "startLine": 557,
        "startChar": 8,
        "endLine": 557,
        "endChar": 9
      },
      "revId": "e14f90a28cc762be1c9a33d605e643a1007aac87",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a5eb2952_ea069484",
        "filename": "lib/nvmf/ctrlr_bdev.c",
        "patchSetId": 4
      },
      "lineNbr": 581,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2019-01-07T23:50:20Z",
      "side": 1,
      "message": "You can do this?\n\n\tnew_reg \u003d TAILQ_FIRST(\u0026subsystem-\u003ereg_head);\n\n\tif (new_reg \u0026\u0026 nvmf_ns_reservation_all_registrants_type(ns)) {\n\t\t/* the next valid registrant is the holder now */\n\t\tns-\u003eholder \u003d new_reg;\n\t\tTAILQ_INSERT_TAIL(\u0026new_reg-\u003ens_head, ns, link);\n\t} else {\n\t\tns-\u003ertype \u003d 0;\n\t\tns-\u003ecrkey \u003d 0;\n\t\tns-\u003eholder \u003d NULL;\n\t}",
      "range": {
        "startLine": 571,
        "startChar": 0,
        "endLine": 581,
        "endChar": 3
      },
      "revId": "e14f90a28cc762be1c9a33d605e643a1007aac87",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2eb0becd_26645395",
        "filename": "lib/nvmf/ctrlr_bdev.c",
        "patchSetId": 4
      },
      "lineNbr": 581,
      "author": {
        "id": 1011204
      },
      "writtenOn": "2019-01-08T05:43:29Z",
      "side": 1,
      "message": "good point.",
      "parentUuid": "a5eb2952_ea069484",
      "range": {
        "startLine": 571,
        "startChar": 0,
        "endLine": 581,
        "endChar": 3
      },
      "revId": "e14f90a28cc762be1c9a33d605e643a1007aac87",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "832f060d_1c58da64",
        "filename": "lib/nvmf/ctrlr_bdev.c",
        "patchSetId": 4
      },
      "lineNbr": 585,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2019-01-07T23:50:20Z",
      "side": 1,
      "message": "-\u003e bool ?",
      "range": {
        "startLine": 585,
        "startChar": 7,
        "endLine": 585,
        "endChar": 15
      },
      "revId": "e14f90a28cc762be1c9a33d605e643a1007aac87",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "954c3184_781de58f",
        "filename": "lib/nvmf/ctrlr_bdev.c",
        "patchSetId": 4
      },
      "lineNbr": 595,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2019-01-07T23:50:20Z",
      "side": 1,
      "message": "Please choose one of reg_tmp or reg. (reg looks natural).",
      "range": {
        "startLine": 593,
        "startChar": 0,
        "endLine": 595,
        "endChar": 17
      },
      "revId": "e14f90a28cc762be1c9a33d605e643a1007aac87",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2c5abeb3_87f4d042",
        "filename": "lib/nvmf/ctrlr_bdev.c",
        "patchSetId": 4
      },
      "lineNbr": 595,
      "author": {
        "id": 1011204
      },
      "writtenOn": "2019-01-08T05:43:29Z",
      "side": 1,
      "message": "sounds good.",
      "parentUuid": "954c3184_781de58f",
      "range": {
        "startLine": 593,
        "startChar": 0,
        "endLine": 595,
        "endChar": 17
      },
      "revId": "e14f90a28cc762be1c9a33d605e643a1007aac87",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0417b812_bfa4c36c",
        "filename": "lib/nvmf/ctrlr_bdev.c",
        "patchSetId": 4
      },
      "lineNbr": 598,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2019-01-07T23:50:20Z",
      "side": 1,
      "message": "same as above -\u003e true",
      "range": {
        "startLine": 598,
        "startChar": 10,
        "endLine": 598,
        "endChar": 11
      },
      "revId": "e14f90a28cc762be1c9a33d605e643a1007aac87",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9bd82504_0b7e2d79",
        "filename": "lib/nvmf/ctrlr_bdev.c",
        "patchSetId": 4
      },
      "lineNbr": 602,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2019-01-07T23:50:20Z",
      "side": 1,
      "message": "-\u003e false?",
      "range": {
        "startLine": 602,
        "startChar": 8,
        "endLine": 602,
        "endChar": 9
      },
      "revId": "e14f90a28cc762be1c9a33d605e643a1007aac87",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "37410e01_95d18a22",
        "filename": "lib/nvmf/ctrlr_bdev.c",
        "patchSetId": 4
      },
      "lineNbr": 606,
      "author": {
        "id": 1011223
      },
      "writtenOn": "2019-01-10T16:03:09Z",
      "side": 1,
      "message": "After reading the spec on this for a while, it looks to me like you\u0027ve implemented it exactly.",
      "revId": "e14f90a28cc762be1c9a33d605e643a1007aac87",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "70801516_750d3119",
        "filename": "lib/nvmf/ctrlr_bdev.c",
        "patchSetId": 4
      },
      "lineNbr": 615,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2019-01-07T23:50:20Z",
      "side": 1,
      "message": "I think you can remove this.\n- returned value is uint32_t but this is int.\n- inlining nvmf_ctrlr_register_registrant() into if block will be possible.",
      "range": {
        "startLine": 615,
        "startChar": 1,
        "endLine": 615,
        "endChar": 8
      },
      "revId": "e14f90a28cc762be1c9a33d605e643a1007aac87",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9dd350bc_d92905d3",
        "filename": "lib/nvmf/ctrlr_bdev.c",
        "patchSetId": 4
      },
      "lineNbr": 626,
      "author": {
        "id": 1014643
      },
      "writtenOn": "2019-01-10T16:43:18Z",
      "side": 1,
      "message": "pthread_mutex_lock can return an error.\nShould be return value checked?",
      "revId": "e14f90a28cc762be1c9a33d605e643a1007aac87",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9bcd7f43_7de64116",
        "filename": "lib/nvmf/ctrlr_bdev.c",
        "patchSetId": 4
      },
      "lineNbr": 629,
      "author": {
        "id": 1011223
      },
      "writtenOn": "2019-01-10T16:03:09Z",
      "side": 1,
      "message": "Do we also want to fail on 10b Set PTPL state to 0, or do we support changing it that way and not the other way?",
      "revId": "e14f90a28cc762be1c9a33d605e643a1007aac87",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "31515861_79ca2750",
        "filename": "lib/nvmf/ctrlr_bdev.c",
        "patchSetId": 4
      },
      "lineNbr": 660,
      "author": {
        "id": 1011223
      },
      "writtenOn": "2019-01-10T16:12:01Z",
      "side": 1,
      "message": "Actually, just realized this. Don\u0027t we not want this else statement? A controller is allowed to have multiple registrants. Also, multiple registrants can have the same key. So as long as we have done the proper check for reg_hostid, then I think we can go ahead and register the host with the controller.\ni.e.\n\tcase SPDK_NVME_RESERVE_REGISTER_KEY:\n\t\tif (reg_hostid) {\n\t\t\tif (reg_hostid-\u003erkey !\u003d key.nrkey) {\n\t\t\t\tSPDK_ERRLOG(\"The same host already register a \"\n\t\t\t\t\t    \"key with 0x%\"PRIx64\"\\n\",\n\t\t\t\t\t    reg_hostid-\u003erkey);\n\t\t\t\tgoto conflict;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t/* register new controller */\n\t\t\tif (key.nrkey \u003d\u003d 0) {\n\t\t\t\tSPDK_ERRLOG(\"Can\u0027t register zeroed new key\\n\");\n\t\t\t\tgoto invalid;\n\t\t\t}\n\t\t\trc \u003d nvmf_ctrlr_register_registrant(ctrlr, key.nrkey);\n\t\t\tif (!rc) {\n\t\t\t\tgoto invalid;\n\t\t\t}",
      "revId": "e14f90a28cc762be1c9a33d605e643a1007aac87",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cd7cd333_e7fe77e6",
        "filename": "lib/nvmf/ctrlr_bdev.c",
        "patchSetId": 4
      },
      "lineNbr": 660,
      "author": {
        "id": 1011204
      },
      "writtenOn": "2019-01-11T01:32:26Z",
      "side": 1,
      "message": "Thanks Seth, two controllers with same Host Identifier should be considered as two different registrants, so reg_hostid is only used to check the registration key, I have a unit test configuration, https://review.gerrithub.io/#/c/spdk/spdk/+/436942/ may be it can describe more clearly.",
      "parentUuid": "31515861_79ca2750",
      "revId": "e14f90a28cc762be1c9a33d605e643a1007aac87",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5b676de7_7130e0ad",
        "filename": "lib/nvmf/ctrlr_bdev.c",
        "patchSetId": 4
      },
      "lineNbr": 706,
      "author": {
        "id": 1014643
      },
      "writtenOn": "2019-01-10T16:43:18Z",
      "side": 1,
      "message": "3 blocks above look very similar. The difference is only in status value.\n\nCan be a single cleanup block is used with an additional \"status\" variable?  \nSomething like that:\n\nif (key.nrkey \u003d\u003d 0) {\n\t\t\tSPDK_ERRLOG(\"Can\u0027t register zeroed new key\\n\");\n\t\t\t//goto invalid;\n                        status \u003d SPDK_NVME_SC_INVALID_FIELD\n                        goto exit;\n\t\t}\nexit:\nreq-\u003ersp-\u003envme_cpl.status.sct \u003d SPDK_NVME_SCT_GENERIC;\nreq-\u003ersp-\u003envme_cpl.status.sc \u003d status;\npthread_mutex_unlock(\u0026subsystem-\u003ereservation_lock);\nreturn SPDK_NVMF_REQUEST_EXEC_STATUS_COMPLETE;",
      "revId": "e14f90a28cc762be1c9a33d605e643a1007aac87",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "87b988a2_716afbc5",
        "filename": "lib/nvmf/ctrlr_bdev.c",
        "patchSetId": 4
      },
      "lineNbr": 706,
      "author": {
        "id": 1011204
      },
      "writtenOn": "2019-01-11T01:32:26Z",
      "side": 1,
      "message": "sounds good to me, thanks.",
      "parentUuid": "5b676de7_7130e0ad",
      "revId": "e14f90a28cc762be1c9a33d605e643a1007aac87",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    }
  ]
}