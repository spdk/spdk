{
  "comments": [
    {
      "key": {
        "uuid": "615e1a2e_5c25aa3c",
        "filename": "lib/blob/blobstore.c",
        "patchSetId": 8
      },
      "lineNbr": 2734,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2019-12-11T01:06:55Z",
      "side": 1,
      "message": "do we also need to set blob-\u003eclear_method here?\n\nmaybe I\u0027m missing it, but I don\u0027t see it - in the current code, blob-\u003eclear_method gets set to opts-\u003eclear_method only in the _spdk_bs_open_blob path",
      "revId": "a37da555121aec905a6f62ef6bac378e98e235bd",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0e966b9e_e0b3a2d2",
        "filename": "lib/blob/blobstore.c",
        "patchSetId": 8
      },
      "lineNbr": 2734,
      "author": {
        "id": 1011289
      },
      "writtenOn": "2019-12-11T17:25:35Z",
      "side": 1,
      "message": "I think you\u0027re right.  Let me spend a little time trying to figure out why I don\u0027t have a UT that would have caught this .",
      "parentUuid": "615e1a2e_5c25aa3c",
      "revId": "a37da555121aec905a6f62ef6bac378e98e235bd",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "be3a2434_e09a8da0",
        "filename": "lib/blob/blobstore.c",
        "patchSetId": 8
      },
      "lineNbr": 2734,
      "author": {
        "id": 1011289
      },
      "writtenOn": "2019-12-11T17:49:11Z",
      "side": 1,
      "message": "Actually I think this code is correct.  When we create a blob we only set it in metadata, there\u0027s no reason to set it in the in memory blob struct that is going to be freed after completion anyway.  When the user opens the blob with ext() they can specify the clear method and if it differs from what was in metadata it will be used. Basically there\u0027s no use of blob-\u003eclear_method in the create path",
      "parentUuid": "0e966b9e_e0b3a2d2",
      "revId": "a37da555121aec905a6f62ef6bac378e98e235bd",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "05609799_e451e920",
        "filename": "lib/blob/blobstore.c",
        "patchSetId": 8
      },
      "lineNbr": 2734,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2019-12-16T17:30:43Z",
      "side": 1,
      "message": "but this doesn\u0027t get freed after completion in the snapshot path",
      "parentUuid": "be3a2434_e09a8da0",
      "revId": "a37da555121aec905a6f62ef6bac378e98e235bd",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "915a577b_2936ea7b",
        "filename": "lib/blob/blobstore.c",
        "patchSetId": 8
      },
      "lineNbr": 4607,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2019-12-16T17:30:43Z",
      "side": 1,
      "message": "should first parameter be newblob?  origblob should already have the clear_method set in metadata\n\nI think probably this should also move to _sync_bs_snapshot_freeze_cpl, before we sync the newblob\u0027s metadata",
      "revId": "a37da555121aec905a6f62ef6bac378e98e235bd",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ca6856a4_cddc2101",
        "filename": "lib/blob/blobstore.c",
        "patchSetId": 8
      },
      "lineNbr": 4607,
      "author": {
        "id": 1011289
      },
      "writtenOn": "2020-01-06T20:44:54Z",
      "side": 1,
      "message": "You are 100% correct.  I was blindly matching _spdk_blob_set_thin_provision() without paying close enough attention to exactly what was going on.  I\u0027ve walked through the snapshot path and believe these are the only things that were incorrect.  Thanks!",
      "parentUuid": "915a577b_2936ea7b",
      "revId": "a37da555121aec905a6f62ef6bac378e98e235bd",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f64b63a0_20985f14",
        "filename": "lib/blob/blobstore.h",
        "patchSetId": 8
      },
      "lineNbr": 280,
      "author": {
        "id": 1011221
      },
      "writtenOn": "2019-11-15T16:10:54Z",
      "side": 1,
      "message": "Not sure that md_ro flags is best place for clear method. As per documentation of descriptor flags below, if md_ro_flags contains flag that application does not know of - blob will only be opened in md_read_only mode. This means that any blob created with this patch, won\u0027t be able to be opened up with SPDK 19.10.\n\nMaybe internal_xattrs might be better place for it, since it solves backwards compatibility issue ?\nOn the other hand.. it complicates _spdk_bs_create_blob() since we already pass entries there.",
      "range": {
        "startLine": 278,
        "startChar": 0,
        "endLine": 280,
        "endChar": 57
      },
      "revId": "a37da555121aec905a6f62ef6bac378e98e235bd",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c5eb67d3_b7f1bae1",
        "filename": "lib/blob/blobstore.h",
        "patchSetId": 8
      },
      "lineNbr": 280,
      "author": {
        "id": 1011289
      },
      "writtenOn": "2019-11-15T17:58:43Z",
      "side": 1,
      "message": "Well, that was kind of the point I thought. If you specify a clear method you expect it to be honored and if you roll back to a version that doesn\u0027t support it you expect it to either not load or, as the design is here, load but in MD RO mode.",
      "parentUuid": "f64b63a0_20985f14",
      "range": {
        "startLine": 278,
        "startChar": 0,
        "endLine": 280,
        "endChar": 57
      },
      "revId": "a37da555121aec905a6f62ef6bac378e98e235bd",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c7374c8a_f31fb5c2",
        "filename": "lib/blob/blobstore.h",
        "patchSetId": 8
      },
      "lineNbr": 280,
      "author": {
        "id": 1011221
      },
      "writtenOn": "2019-11-15T20:14:06Z",
      "side": 1,
      "message": "Agreed after discussing it. Even tough it was part of blob open previously, was kind of thinking it of not as a new property.\n\nYou are right, it should not work when using older version.",
      "parentUuid": "c5eb67d3_b7f1bae1",
      "range": {
        "startLine": 278,
        "startChar": 0,
        "endLine": 280,
        "endChar": 57
      },
      "revId": "a37da555121aec905a6f62ef6bac378e98e235bd",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f80d4365_88ae9eb9",
        "filename": "test/unit/lib/blob/blob.c/blob_ut.c",
        "patchSetId": 8
      },
      "lineNbr": 3985,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2019-12-16T17:30:43Z",
      "side": 1,
      "message": "I think we need some more unit tests for clear_method for the snapshot path.  Those probably don\u0027t belong in blob_flags(), but the snapshot-specific ones instead.",
      "revId": "a37da555121aec905a6f62ef6bac378e98e235bd",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    }
  ]
}