{
  "comments": [
    {
      "key": {
        "uuid": "b2d9f77a_ad3af2ca",
        "filename": "lib/nvmf/muser.c",
        "patchSetId": 4
      },
      "lineNbr": 2258,
      "author": {
        "id": 1016781
      },
      "writtenOn": "2020-01-24T17:11:30Z",
      "side": 1,
      "message": "That is partially addressed with patch below (already merged).\nhttps://review.gerrithub.io/c/spdk/spdk/+/479511 \"nvmf: pass listen done cb to transport specific code\"\n\nSubsystem is stopped during add_listener rpc call and there is a proposition to go around that (WIP).\nhttps://review.gerrithub.io/c/spdk/spdk/+/481409 \"nvmf/ctrlr: introduce ctrlr connect backdoor\"",
      "range": {
        "startLine": 2249,
        "startChar": 0,
        "endLine": 2258,
        "endChar": 4
      },
      "revId": "45c09399ce6f671576334c723b7c5f232614c014",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "704f8cf1_56adbf10",
        "filename": "lib/nvmf/muser.c",
        "patchSetId": 4
      },
      "lineNbr": 2258,
      "author": {
        "id": 1017478
      },
      "writtenOn": "2020-01-27T11:34:47Z",
      "side": 1,
      "message": "Right, I see how using the already merged patch can help me fix this the way I explain in the comment: we return from this function before add_qp and call add_qp in handle_connect_rsp where we call cb_fn so that muser_listen really finishes. Correct?\n\nI\u0027m not sure I understand at all the second patch you mention? How does it affect this probme?",
      "parentUuid": "b2d9f77a_ad3af2ca",
      "range": {
        "startLine": 2249,
        "startChar": 0,
        "endLine": 2258,
        "endChar": 4
      },
      "revId": "45c09399ce6f671576334c723b7c5f232614c014",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1d16238e_7f24f735",
        "filename": "lib/nvmf/muser.c",
        "patchSetId": 4
      },
      "lineNbr": 2258,
      "author": {
        "id": 1016781
      },
      "writtenOn": "2020-01-27T15:03:34Z",
      "side": 1,
      "message": "Conceptually correct, you need to defer done callback until it is really done. As soon as you try to do that you will see an issue with \u0027add_qp\u0027, as listen is not \u0027done\u0027 subsystem is still paused. In \u0027connect\u0027 procedure there is a check for subsystem state which would prevent to connect successfully.\n\nSo the second patch tries to go around that but approach is not approved yet. Feedback is welcome ;)",
      "parentUuid": "704f8cf1_56adbf10",
      "range": {
        "startLine": 2249,
        "startChar": 0,
        "endLine": 2258,
        "endChar": 4
      },
      "revId": "45c09399ce6f671576334c723b7c5f232614c014",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    }
  ]
}