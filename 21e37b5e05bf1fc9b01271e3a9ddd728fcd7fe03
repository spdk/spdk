{
  "comments": [
    {
      "key": {
        "uuid": "ddc4b32f_9c8e65fb",
        "filename": "lib/vhost/vhost_blk.c",
        "patchSetId": 13
      },
      "lineNbr": 648,
      "author": {
        "id": 1011218
      },
      "writtenOn": "2018-02-07T13:33:16Z",
      "side": 1,
      "message": "can we return max number of supported queues here?\nfor equivalent num_queues field in vhost-scsi, the virtio 1.0 doc says:\n\n```\nnum_queues\nis the total number of request virtqueues exposed by the device. The driver MAY use only one request queue, or it can use more to achieve better performance.\n```",
      "range": {
        "startLine": 648,
        "startChar": 1,
        "endLine": 648,
        "endChar": 24
      },
      "revId": "21e37b5e05bf1fc9b01271e3a9ddd728fcd7fe03",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ca02c528_4002c11f",
        "filename": "lib/vhost/vhost_blk.c",
        "patchSetId": 13
      },
      "lineNbr": 648,
      "author": {
        "id": 1011204
      },
      "writtenOn": "2018-02-08T06:25:22Z",
      "side": 1,
      "message": "It\u0027s a little tricky here, QEMU vhost uses VHOST_USER_GET_QUEUE_NUM to get maximum queue number, and it also allow users to input the desired number of I/O queues(num_queues should \u003c\u003d the maximum queue number), for the purpose to fully support this, we need to refactor the vhost_dev_init(get virtio configuration information before initializing the queues) API in QEMU, I choose to the simple way to keep the original logic, so currently the value here does not take effect.",
      "parentUuid": "ddc4b32f_9c8e65fb",
      "range": {
        "startLine": 648,
        "startChar": 1,
        "endLine": 648,
        "endChar": 24
      },
      "revId": "21e37b5e05bf1fc9b01271e3a9ddd728fcd7fe03",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "143d6a47_5e710e76",
        "filename": "lib/vhost/vhost_blk.c",
        "patchSetId": 13
      },
      "lineNbr": 648,
      "author": {
        "id": 1011218
      },
      "writtenOn": "2018-02-09T07:41:15Z",
      "side": 1,
      "message": "I\u0027m suggesting to change this num_queues value because of the SPDK virtio driver [1]\n\nIn our virtio drivers we use a generic virtio library that abstracts away vhost-user/virtio-pci. The cross-platform way to read the number of queues would be to read it from device config. For virtio-pci it will do MMIO reads, for vhost-user it will send GET_CONFIG.\n\nAlso, VHOST_USER_GET_QUEUE_NUM returns the number of all virtqueues (not just request queues).\nIt doesn\u0027t matter for virtio-blk, as there aren\u0027t any queues other than requestq, but the SPDK virtio library has been designed for all virtio backends.\n\nI\u0027m asking if this num_queues value can be changed because it won\u0027t hurt anything and could simplify SPDK virtio-blk driver implementation.\n\n[1] https://review.gerrithub.io/c/393056/",
      "parentUuid": "ca02c528_4002c11f",
      "range": {
        "startLine": 648,
        "startChar": 1,
        "endLine": 648,
        "endChar": 24
      },
      "revId": "21e37b5e05bf1fc9b01271e3a9ddd728fcd7fe03",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    }
  ]
}