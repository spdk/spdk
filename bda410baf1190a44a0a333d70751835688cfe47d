{
  "comments": [
    {
      "key": {
        "uuid": "6ef799ed_cad88ad7",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 874,
      "author": {
        "id": 1015344
      },
      "writtenOn": "2019-04-12T10:02:13Z",
      "side": 1,
      "message": "Why not to keep this cache_size with other cache members and set it during init - it can\u0027t be changed during runtime and you need to get bdev each time to retrive this information.",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "19007a2b_c1905359",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 874,
      "author": {
        "id": 1015368
      },
      "writtenOn": "2019-04-12T10:46:58Z",
      "side": 1,
      "message": "I don\u0027t see a point in doing so - it\u0027s just a simple getter, what\u0027s the point in keeping the same info in two places?",
      "parentUuid": "6ef799ed_cad88ad7",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d0d107d0_2f6a2fa3",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 874,
      "author": {
        "id": 1015344
      },
      "writtenOn": "2019-04-12T11:26:41Z",
      "side": 1,
      "message": "But to use this getter you need to call spdk_bdev_desc_get_bdev(), I don\u0027t like idea that we propagating bdev among FTL code. Let\u0027s keep this separate as possiable.",
      "parentUuid": "19007a2b_c1905359",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4cef1b29_9b0e7acc",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 874,
      "author": {
        "id": 1015368
      },
      "writtenOn": "2019-04-12T12:41:26Z",
      "side": 1,
      "message": "What do you mean by propagating bdev among FTL code? We\u0027re using bdev interface, so of course we\u0027re using its functions. Also we\u0027re going to have much more bdev calls soon, while implementing zoned namespaces (which will replace all the NVMe driver calls with bdev ones).",
      "parentUuid": "d0d107d0_2f6a2fa3",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "f9034b2f_e040776f",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 874,
      "author": {
        "id": 1015344
      },
      "writtenOn": "2019-04-12T13:02:18Z",
      "side": 1,
      "message": "I think this code will be look easier if we remember cache size in inetrnal cache structure. In this fucntion you could remove bdev and cache size temp varaibles and get rid of spdk_bdev_desc_get_bdev call",
      "parentUuid": "4cef1b29_9b0e7acc",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c79c6713_2e19d823",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 916,
      "author": {
        "id": 1015344
      },
      "writtenOn": "2019-04-12T10:02:13Z",
      "side": 1,
      "message": "ftl_nv_cache_write_cb?",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3aa47a63_666fa9ac",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 916,
      "author": {
        "id": 1015368
      },
      "writtenOn": "2019-04-12T10:46:58Z",
      "side": 1,
      "message": "The function that sets this callback is called ftl_submit_nv_cache, so I believe this name is appropriate.",
      "parentUuid": "c79c6713_2e19d823",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "569f12a0_dddc29d3",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 916,
      "author": {
        "id": 1015344
      },
      "writtenOn": "2019-04-12T11:26:41Z",
      "side": 1,
      "message": "We have read_cb, write_cb, write_md_cb etc. - I prefer to keep this notation",
      "parentUuid": "3aa47a63_666fa9ac",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9e46f6f0_e367be49",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 916,
      "author": {
        "id": 1015368
      },
      "writtenOn": "2019-04-12T12:41:26Z",
      "side": 1,
      "message": "We also have ftl_nv_cache_write which is not really related to this, therefore I believe this name is better and don\u0027t think it needs to be changed.",
      "parentUuid": "569f12a0_dddc29d3",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d6580363_a8c685f6",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 981,
      "author": {
        "id": 1015344
      },
      "writtenOn": "2019-04-12T10:02:13Z",
      "side": 1,
      "message": "We should add cache_addr/offset to IO instead relying on physical page address. Also this cache_addr variable could be removed.",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1d880403_bf653c3b",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 981,
      "author": {
        "id": 1015368
      },
      "writtenOn": "2019-04-12T10:46:58Z",
      "side": 1,
      "message": "Let\u0027s not clutter ftl_io with another variable, especially when we have one that can hold this data perfectly well - PPA that is supposed to point at some area on the SSD, while LBA is always our logical address.",
      "parentUuid": "d6580363_a8c685f6",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "03217ed7_2e3da1c0",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 981,
      "author": {
        "id": 1015344
      },
      "writtenOn": "2019-04-12T11:26:41Z",
      "side": 1,
      "message": "We are operating on offset during cache write, so it is quite diffrent concept - ppa addresses are not contiguous.",
      "parentUuid": "1d880403_bf653c3b",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "04621423_2b6aeee9",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 981,
      "author": {
        "id": 1015368
      },
      "writtenOn": "2019-04-12T12:41:26Z",
      "side": 1,
      "message": "ftl_ppa is a union of an 64-bit unsigned integer and some other fields describing OC drive\u0027s geometry. It doesn\u0027t matter if it\u0027s contiguous or not - PPA is just an address that is supposed to a physical location on the SSD (as opposed to a logical address used by the user of the FTL).\nHere the 64 bit int portion of the union is used. I really don\u0027t see the point in adding yet another field to an already large structure (ftl_io), especially as we don\u0027t really need to as the IO either goes to OC drive or cache drive. Creating a union with an uint64_t and ftl_ppa will only complicate things and doesn\u0027t make sense, as ftl_ppa by definition is uint64_t.",
      "parentUuid": "03217ed7_2e3da1c0",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6b16eb64_93dcd0de",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 981,
      "author": {
        "id": 1015344
      },
      "writtenOn": "2019-04-12T13:02:18Z",
      "side": 1,
      "message": "So why you are using cache_addr variable? I think we could refactor IO struct at some point but we were already adding fields to it with less justification.",
      "parentUuid": "04621423_2b6aeee9",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "caefb241_aa5413b7",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 983,
      "author": {
        "id": 1015344
      },
      "writtenOn": "2019-04-12T10:02:13Z",
      "side": 1,
      "message": "Do we need to free such IO, why just not to retry it?",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b81fd869_9c7ec6a2",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 983,
      "author": {
        "id": 1015368
      },
      "writtenOn": "2019-04-12T10:46:58Z",
      "side": 1,
      "message": "What\u0027s the difference? It\u0027d just make the code more complicated.",
      "parentUuid": "caefb241_aa5413b7",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a7bd2fef_5192ea49",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 983,
      "author": {
        "id": 1015344
      },
      "writtenOn": "2019-04-12T11:26:41Z",
      "side": 1,
      "message": "I think we should rely on flt_io_completion and not call ftl_io_free directly. Also I think we shouldn\u0027t have those return statments inside loops but do breaks so we can have one place where we are doing spdk_thread_send_msg(thread, _ftl_write_nv_cache, io);",
      "parentUuid": "b81fd869_9c7ec6a2",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8424fdf8_f631fcab",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 983,
      "author": {
        "id": 1015368
      },
      "writtenOn": "2019-04-12T12:41:26Z",
      "side": 1,
      "message": "Why shouldn\u0027t we call ftl_io_free directly? It\u0027s perfectly valid thing to do, if the IO cannot be sent for some reason. The return statement can be replaced with a break, sure.",
      "parentUuid": "a7bd2fef_5192ea49",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3c69482b_6cce7349",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 990,
      "author": {
        "id": 1015344
      },
      "writtenOn": "2019-04-12T10:02:13Z",
      "side": 1,
      "message": "Please comment each of those \"if\u0027s\"",
      "range": {
        "startLine": 976,
        "startChar": 0,
        "endLine": 990,
        "endChar": 3
      },
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2319d341_e3444a69",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 990,
      "author": {
        "id": 1015368
      },
      "writtenOn": "2019-04-12T10:46:58Z",
      "side": 1,
      "message": "I don\u0027t see a point. There\u0027s no magic here, the code is pretty self explanatory.",
      "parentUuid": "3c69482b_6cce7349",
      "range": {
        "startLine": 976,
        "startChar": 0,
        "endLine": 990,
        "endChar": 3
      },
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a84b2548_3360b05b",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 990,
      "author": {
        "id": 1015344
      },
      "writtenOn": "2019-04-12T11:26:41Z",
      "side": 1,
      "message": "During review process those condition was not so obvious to me e.g cache_addr \u003d\u003d FTL_LBA_INVALID  You could add comment that there is no avaiable cache right now so let\u0027s try one more time - you could also wrap this condtion in something like ftl_cache_avaiable similar like we are doing it in ftl_read_retry.",
      "parentUuid": "2319d341_e3444a69",
      "range": {
        "startLine": 976,
        "startChar": 0,
        "endLine": 990,
        "endChar": 3
      },
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d49a64bd_383f0e56",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 990,
      "author": {
        "id": 1015368
      },
      "writtenOn": "2019-04-12T12:41:26Z",
      "side": 1,
      "message": "By that logic every condition should be commented. I really don\u0027t think the code here is complicated enough to require extensive comments. Also, there\u0027s tons of places we\u0027re just checking comparing the result of a function.",
      "parentUuid": "a84b2548_3360b05b",
      "range": {
        "startLine": 976,
        "startChar": 0,
        "endLine": 990,
        "endChar": 3
      },
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "17d554ac_e25859d6",
        "filename": "lib/ftl/ftl_core.c",
        "patchSetId": 11
      },
      "lineNbr": 990,
      "author": {
        "id": 1015344
      },
      "writtenOn": "2019-04-12T13:02:18Z",
      "side": 1,
      "message": "I have different feel - I thinks this FTL_LBA_INVALID and shring case should be commented.",
      "parentUuid": "d49a64bd_383f0e56",
      "range": {
        "startLine": 976,
        "startChar": 0,
        "endLine": 990,
        "endChar": 3
      },
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b7f20d51_5d2588d5",
        "filename": "lib/ftl/ftl_io.c",
        "patchSetId": 11
      },
      "lineNbr": 48,
      "author": {
        "id": 1015344
      },
      "writtenOn": "2019-04-12T10:02:13Z",
      "side": 1,
      "message": "Please move this condition to separete funciotn.",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0efa46ae_13665c4c",
        "filename": "lib/ftl/ftl_io.c",
        "patchSetId": 11
      },
      "lineNbr": 48,
      "author": {
        "id": 1015368
      },
      "writtenOn": "2019-04-12T10:46:58Z",
      "side": 1,
      "message": "I don\u0027t really see a point. It\u0027s just a simple flag check, we\u0027re doing it all over the code with other flags.",
      "parentUuid": "b7f20d51_5d2588d5",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c93f52b4_81081389",
        "filename": "lib/ftl/ftl_io.c",
        "patchSetId": 11
      },
      "lineNbr": 48,
      "author": {
        "id": 1015344
      },
      "writtenOn": "2019-04-12T11:26:41Z",
      "side": 1,
      "message": "I think this condition is too much complex right now - !(io-\u003eflags \u0026 FTL_IO_CACHE) \u0026\u0026 io-\u003etype\u003d\u003d FTL_IO_WRITE wouldn\u0027t be sufficient?",
      "parentUuid": "0efa46ae_13665c4c",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6f1f976a_e8a88ecc",
        "filename": "lib/ftl/ftl_io.c",
        "patchSetId": 11
      },
      "lineNbr": 48,
      "author": {
        "id": 1015368
      },
      "writtenOn": "2019-04-12T12:41:26Z",
      "side": 1,
      "message": "The only thing added here is additional check, that the IO is not directed to the non-volatile cache. I\u0027m not changing the other part of the condition, as it\u0027s not a subject of this patch.",
      "parentUuid": "c93f52b4_81081389",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2f21613c_9f8ede2d",
        "filename": "lib/ftl/ftl_io.c",
        "patchSetId": 11
      },
      "lineNbr": 48,
      "author": {
        "id": 1015344
      },
      "writtenOn": "2019-04-12T13:02:18Z",
      "side": 1,
      "message": "I don\u0027t really understand - let\u0027s simplify it if we can here.",
      "parentUuid": "6f1f976a_e8a88ecc",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4186124c_53f76f3a",
        "filename": "lib/ftl/ftl_io.c",
        "patchSetId": 11
      },
      "lineNbr": 63,
      "author": {
        "id": 1015344
      },
      "writtenOn": "2019-04-12T10:02:13Z",
      "side": 1,
      "message": "^",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2b3e67cf_77b990f2",
        "filename": "lib/ftl/ftl_io.c",
        "patchSetId": 11
      },
      "lineNbr": 63,
      "author": {
        "id": 1015368
      },
      "writtenOn": "2019-04-12T10:46:58Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "4186124c_53f76f3a",
      "revId": "bda410baf1190a44a0a333d70751835688cfe47d",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    }
  ]
}