{
  "comments": [
    {
      "key": {
        "uuid": "5380b66f_1acb8c35",
        "filename": "include/spdk/nvme.h",
        "patchSetId": 4
      },
      "lineNbr": 49,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2018-05-31T18:20:13Z",
      "side": 1,
      "message": "If the user wants to use OCSSD, they need to include the OCSSD header themselves. I don\u0027t think it should be automatically included in the main public API.",
      "revId": "38e33919be2b779fab3851f2d749b402225eecf7",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae7c0347_b87fcf7b",
        "filename": "include/spdk/nvme.h",
        "patchSetId": 4
      },
      "lineNbr": 49,
      "author": {
        "id": 1013988
      },
      "writtenOn": "2018-06-04T12:33:44Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "5380b66f_1acb8c35",
      "revId": "38e33919be2b779fab3851f2d749b402225eecf7",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "51a86b0d_e2fdfc39",
        "filename": "include/spdk/nvme_ocssd.h",
        "patchSetId": 4
      },
      "lineNbr": 89,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2018-05-31T18:20:13Z",
      "side": 1,
      "message": "spdk_nvme_ctrlr_cmd_get_feature() already exists. The only difference is that there is no ns_id argument in the existing one. However, OCSSD defines one new feature (Media Feedback), and that command doesn\u0027t need an ns_id. Given that, I think this function isn\u0027t necessary and can be deleted.",
      "revId": "38e33919be2b779fab3851f2d749b402225eecf7",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b8a9f5c1_ce8f7514",
        "filename": "include/spdk/nvme_ocssd.h",
        "patchSetId": 4
      },
      "lineNbr": 89,
      "author": {
        "id": 1013988
      },
      "writtenOn": "2018-06-04T12:33:44Z",
      "side": 1,
      "message": "I would like to discuss this change.\nPlease see Figure 9 (Opcodes for Admin Commands) in OCSSD 2.0 spec. It is defined there that Namespace Identifier is used (for Get/Set Features - Media Feedback, Get Log Page - Chunk Information) and I see no changes in that in Denali document too.\nHowever NVMe 1.3 does not specify that ns_id is required for Get/Set features.\n\nWhen I test \"Get/Set Features - Get Log Page - Chunk Information\" with nsid \u003d 0 on HW I am receiving error  \nnvme_qpair_print_completion: *NOTICE*: INVALID NAMESPACE OR FORMAT (00/0b).\n\nI could add more description to function headers to explain why they are needed.",
      "parentUuid": "51a86b0d_e2fdfc39",
      "revId": "38e33919be2b779fab3851f2d749b402225eecf7",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a380888f_13283b8e",
        "filename": "include/spdk/nvme_ocssd.h",
        "patchSetId": 4
      },
      "lineNbr": 89,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2018-06-05T18:35:20Z",
      "side": 1,
      "message": "I see. I\u0027m reading through the specification now and I\u0027ll follow up with the specification committee to get this clarified. I\u0027m not even sure what a \"namespace\" means for an OCSSD, and certainly none of these commands should be operating at a namespace granularity. Can you try sending all 0xF\u0027s instead of 0 and see what happens?",
      "parentUuid": "b8a9f5c1_ce8f7514",
      "revId": "38e33919be2b779fab3851f2d749b402225eecf7",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "edfd0160_f3ae6ce4",
        "filename": "include/spdk/nvme_ocssd.h",
        "patchSetId": 4
      },
      "lineNbr": 89,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2018-06-05T20:57:16Z",
      "side": 1,
      "message": "Ok - it turns out this one is really tricky. Figure 9 from the OCSSD 2.0 spec is supposed to be the OCSSD version of Figure 42 in NVMe 1.3c. Note footnote 3 on Figure 42 that says:\n\n~~~\nA subset of commands uses the Namespace Identifier field (CDW1.NSID). If the Namespace Identifier field is used, then unless otherwise specified, the value FFFFFFFFh is supported in this field. When this field is not used, the field is cleared to 0h as described in Figure 11. \n~~~\n\nThe key to understanding this statement is the meaning of the word \"used\" which isn\u0027t at all clear in this context. However, the footnote used to read as follows in NVMe 1.0:\n\n~~~\nA subset of commands uses the Namespace Identifier field (CDW1.NSID). When not used, the field shall be cleared to 0h. For the Get Features and Set Features command, the Namespace Identifier is only used for the LBA Range Type feature.\n~~~\n\nIn that version of the specification, it\u0027s clear that \"used\" means only if the feature is specifically LBA Range Type - not all Set/Get features commands. So the namespace rules apply only to certain sub-commands, not to the entirety of any command marked as \"Yes\" in Figure 9. It happens that Media Feedback, the new feature in this specification, does not need the namespace (what even is a namespace in OCSSD?), so the correct value to send here is 0.\n\nThat means your firmware developers got it wrong and need to make an update. Further, it\u0027s not really their fault that they got it wrong - this is deeply confusing in the specification. When the language around this was changed in NVMe 1.2, LBA Range Type was never updated to indicate that it uses the namespace identifier at all! I\u0027ll start the process of working with the spec committee to get this cleared up.\n\nIn the mean time, you can add an spdk_nvme_ctrlr_cmd_get_feature_with_nsid to the base SPDK NVMe driver. We don\u0027t have that function and it would be required in order to get/set features for LBA Range Type and Persistent Reservations anyway. Once that\u0027s in the base NVMe driver, you can use it temporarily as a workaround for the device you\u0027re developing against.",
      "parentUuid": "a380888f_13283b8e",
      "revId": "38e33919be2b779fab3851f2d749b402225eecf7",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4898869d_7db0bd1b",
        "filename": "include/spdk/nvme_ocssd.h",
        "patchSetId": 4
      },
      "lineNbr": 89,
      "author": {
        "id": 1013988
      },
      "writtenOn": "2018-06-06T14:32:56Z",
      "side": 1,
      "message": "Thank you for clarifying this. It is really confused.\n\nBen: Can you try sending all 0xF\u0027s instead of 0 and see what happens?\n\nON POC HW/FW when nsid\u003d0 I see error (I will clarify with FW team), 0xFFFFFFFF is ok\n\nBen: It happens that Media Feedback, the new feature in this specification, does not need the namespace (what even is a namespace in OCSSD?), so the correct value to send here is 0.\n\nI agree with you, I will start email thread with FW team about this\n\nBen: In the mean time, you can add an spdk_nvme_ctrlr_cmd_get_feature_with_nsid to the base SPDK NVMe driver. \n\nDone",
      "parentUuid": "edfd0160_f3ae6ce4",
      "revId": "38e33919be2b779fab3851f2d749b402225eecf7",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "22b17f10_4e595006",
        "filename": "include/spdk/nvme_ocssd.h",
        "patchSetId": 4
      },
      "lineNbr": 117,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2018-05-31T18:20:13Z",
      "side": 1,
      "message": "Similarly to the get feature comment above, the set feature here does not need the ns_id specified, so the existing spdk_nvme_ctrlr_cmd_set_feature can be used.",
      "revId": "38e33919be2b779fab3851f2d749b402225eecf7",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e054290c_d8042a3a",
        "filename": "include/spdk/nvme_ocssd.h",
        "patchSetId": 4
      },
      "lineNbr": 117,
      "author": {
        "id": 1013988
      },
      "writtenOn": "2018-06-04T12:33:44Z",
      "side": 1,
      "message": "Please see my response above. Unfortunately existing spdk_nvme_ctrlr_cmd_set_feature returns error for Get/Set Features - Media Feedback, Get Log Page - Chunk Information on HW.",
      "parentUuid": "22b17f10_4e595006",
      "revId": "38e33919be2b779fab3851f2d749b402225eecf7",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "83e9aa92_6abfee90",
        "filename": "lib/nvme/nvme_ctrlr_ocssd_cmd.c",
        "patchSetId": 4
      },
      "lineNbr": 48,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2018-05-31T18:20:13Z",
      "side": 1,
      "message": "This needs to take the ctrlr_lock",
      "revId": "38e33919be2b779fab3851f2d749b402225eecf7",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a9122760_dc80034d",
        "filename": "lib/nvme/nvme_ctrlr_ocssd_cmd.c",
        "patchSetId": 4
      },
      "lineNbr": 48,
      "author": {
        "id": 1013988
      },
      "writtenOn": "2018-06-04T12:33:44Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "83e9aa92_6abfee90",
      "revId": "38e33919be2b779fab3851f2d749b402225eecf7",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b9439b2c_e24fec07",
        "filename": "lib/nvme/nvme_qpair.c",
        "patchSetId": 4
      },
      "lineNbr": 69,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2018-05-31T18:20:13Z",
      "side": 1,
      "message": "This is not a standard opcode, so I\u0027d prefer to leave this change out of the patch. That means that the print statement will just show \"ADMIN COMMAND\" instead of \"OCSSD / GEOMETRY\", but I think that\u0027s ok.",
      "revId": "38e33919be2b779fab3851f2d749b402225eecf7",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7916f3a2_dbf47f15",
        "filename": "lib/nvme/nvme_qpair.c",
        "patchSetId": 4
      },
      "lineNbr": 69,
      "author": {
        "id": 1010531
      },
      "writtenOn": "2018-05-31T18:20:13Z",
      "side": 1,
      "message": "This is not a standard opcode, so I\u0027d prefer to leave this out of the patch. That means the print will just show \"ADMIN COMMAND\" for this OCSSD command, but I think that\u0027s fine.",
      "revId": "38e33919be2b779fab3851f2d749b402225eecf7",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "adfb0e45_5e2c83c1",
        "filename": "lib/nvme/nvme_qpair.c",
        "patchSetId": 4
      },
      "lineNbr": 69,
      "author": {
        "id": 1013988
      },
      "writtenOn": "2018-06-04T12:33:44Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "b9439b2c_e24fec07",
      "revId": "38e33919be2b779fab3851f2d749b402225eecf7",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    }
  ]
}