{
  "comments": [
    {
      "key": {
        "uuid": "1a0a3ae5_3f1519c8",
        "filename": "lib/bdev/crypto/vbdev_crypto.c",
        "patchSetId": 6
      },
      "lineNbr": 95,
      "author": {
        "id": 1011289
      },
      "writtenOn": "2019-01-09T22:32:49Z",
      "side": 1,
      "message": "I think you mean \"at most 2 mbufs\" not crypto operations per src \u0026 dst",
      "revId": "cc08f6fc562287ba0c22ce4d846b14be5bdc8469",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "06709796_2a760b74",
        "filename": "lib/bdev/crypto/vbdev_crypto.c",
        "patchSetId": 6
      },
      "lineNbr": 95,
      "author": {
        "id": 1011218
      },
      "writtenOn": "2019-01-10T10:10:02Z",
      "side": 1,
      "message": "If you\u0027re encrypting a single 4k block but both the src and dst buffer needs to be split, then you\u0027ll theoretically end up with 3 different rte_crypto_op.\n\nCould you elaborate on that comment? I didn\u0027t really get your point.",
      "parentUuid": "1a0a3ae5_3f1519c8",
      "revId": "cc08f6fc562287ba0c22ce4d846b14be5bdc8469",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "197c02a5_217fa75f",
        "filename": "lib/bdev/crypto/vbdev_crypto.c",
        "patchSetId": 6
      },
      "lineNbr": 95,
      "author": {
        "id": 1011289
      },
      "writtenOn": "2019-01-10T15:15:50Z",
      "side": 1,
      "message": "I don\u0027t think we will ever need an extra crypto operation since all we\u0027re doing here is chaining more mbufs to the existing operation. I don\u0027t understand why you think we need an extra op?\n\nIf you take the case you just mentioned and walk through the code below I still only see one crypto_op for the 4K transfer with some number of src mbufs and some number of dst mbufs depending on how contiguous the src/dst blocks are.\n\nRight?",
      "parentUuid": "06709796_2a760b74",
      "revId": "cc08f6fc562287ba0c22ce4d846b14be5bdc8469",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "64d9e7cf_7d81faf2",
        "filename": "lib/bdev/crypto/vbdev_crypto.c",
        "patchSetId": 6
      },
      "lineNbr": 95,
      "author": {
        "id": 1011289
      },
      "writtenOn": "2019-01-10T15:32:48Z",
      "side": 1,
      "message": "Never mind.  I wrote this like 5 different ways including one that supported mbuf chaining which this one does not because it was simpler in that only QAT supports chaining but not AESNI.  Without chaining you are right, you need another crypto op.  Thinking out loud though, remember that the IV is the LBA and is associated with a crypto op.  So right now there is a 1:1 between crypto op, mbuf and IV.  If you split a block sized crpyto op into 2 crypto ops they\u0027re both going to get the same IV but I suppose that\u0027s OK because both crypto operations are operating on the same block just different memory offsets.  I assume that will work but don\u0027t know for sure of course.\n\nAnother approach would be to support chaining for QAT and not for AESNI.  AESNI never needs physical addresses so we don\u0027t have the problem there and with chaining we can just keep one crypto op and add as many src/dst buffers to it as needed to describe the non-contig buffer.  I can work on that when I\u0027m back if you like, I implemented once already a long time ago :)\n\nOr, we can try this as is.... adding chaining would also boost QAT performance",
      "parentUuid": "197c02a5_217fa75f",
      "revId": "cc08f6fc562287ba0c22ce4d846b14be5bdc8469",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "586a9aeb_454d5b9b",
        "filename": "lib/bdev/crypto/vbdev_crypto.c",
        "patchSetId": 6
      },
      "lineNbr": 103,
      "author": {
        "id": 1011289
      },
      "writtenOn": "2019-01-09T22:32:49Z",
      "side": 1,
      "message": "this only controls the size of the arrays in the crypto submission function, technically you don\u0027t 3x as many crypto ops but no big deal.\n\nmbuf sizing is sort of a \"thumb it\" anyway but to account for the potential increase in number of mbufs allocated you need to change the define just below here",
      "revId": "cc08f6fc562287ba0c22ce4d846b14be5bdc8469",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9dbfb117_cf764f2c",
        "filename": "lib/bdev/crypto/vbdev_crypto.c",
        "patchSetId": 6
      },
      "lineNbr": 603,
      "author": {
        "id": 1011289
      },
      "writtenOn": "2019-01-09T22:32:49Z",
      "side": 1,
      "message": "get the crypto ops, src and dst mbufs",
      "revId": "cc08f6fc562287ba0c22ce4d846b14be5bdc8469",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d6223fc8_06defa62",
        "filename": "lib/bdev/crypto/vbdev_crypto.c",
        "patchSetId": 6
      },
      "lineNbr": 603,
      "author": {
        "id": 1011218
      },
      "writtenOn": "2019-01-10T10:10:02Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "9dbfb117_cf764f2c",
      "revId": "cc08f6fc562287ba0c22ce4d846b14be5bdc8469",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    }
  ]
}