{
  "comments": [
    {
      "key": {
        "uuid": "a4cfd3e0_24fb088e",
        "filename": "lib/nvme/nvme.c",
        "patchSetId": 10
      },
      "lineNbr": 429,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2019-10-04T23:29:50Z",
      "side": 1,
      "message": "We should consider changing _nvme_pcie_hotplug_monitor to now use ctrlr-\u003eremove_cb instead of probe-\u003eremove_cb.\n\nI think your patch is correct, but it leads to an odd API consideration where use could specify a remove_cb when the ctrlr was originally probed, but a different remove_cb could be specified later when doing a probe to find hot-removed PCIe devices.  It\u0027s not clear in the API which would be used.  I think we should use this ctrlr-\u003eremove_cb in all cases, rather than probe-\u003eremove_cb for PCIe and ctrlr-\u003eremove_cb for fabrics controllers.",
      "revId": "5aa765e6f052c0dfbde50fe7ad5464f5611a82a1",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "dc1a4c52_d6e1b3ba",
        "filename": "lib/nvme/nvme.c",
        "patchSetId": 10
      },
      "lineNbr": 429,
      "author": {
        "id": 1011223
      },
      "writtenOn": "2019-10-05T00:02:14Z",
      "side": 1,
      "message": "Yeah, I definitely agree with this. The hard part (from my perspective) is that the user facing APIs for hotplug all require passing in a probe_ctx which includes a remove_cb. I was thinking that in order to clear up that confusion, we would need to update that whole API chain with a new wrapper struct that doesn\u0027t contain a remove_cb. I can do that before this patch if you\u0027d like, or if you feel that there is a simpler way - maybe just documenting the function calls to indicate that the remove_cb the user passes in for hotplug will be unused - I\u0027m good to do that too. I just wasn\u0027t sure about the best path.",
      "parentUuid": "a4cfd3e0_24fb088e",
      "revId": "5aa765e6f052c0dfbde50fe7ad5464f5611a82a1",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d3195a97_96588bca",
        "filename": "lib/nvme/nvme.c",
        "patchSetId": 10
      },
      "lineNbr": 429,
      "author": {
        "id": 1011223
      },
      "writtenOn": "2019-10-07T16:23:24Z",
      "side": 1,
      "message": "Nevermind, I am thinking a bit more clearly on Monday morning. We will need to keep the destroy_cb in the context for when we hot-insert a controller. I will just update the docs to make it clear that the remove_cb provided in the probe_ctx is only for new controllers.",
      "parentUuid": "dc1a4c52_d6e1b3ba",
      "revId": "5aa765e6f052c0dfbde50fe7ad5464f5611a82a1",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    }
  ]
}