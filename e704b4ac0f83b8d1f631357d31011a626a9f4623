{
  "comments": [
    {
      "key": {
        "uuid": "ed0194e6_a25f704f",
        "filename": "lib/scsi/lun.c",
        "patchSetId": 4
      },
      "lineNbr": 77,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2017-11-15T22:23:17Z",
      "side": 1,
      "message": "I think this whole loop can be removed now.\n\nThis function only gets called after a LUN reset is completed.  If there are outstanding tasks on this lun-\u003etasks list, we cannot complete them here (since backend may complete them later).  But setting status to CHECK_CONDITION is not necessary then.  Later, if the task does complete, we can just use the status from that completion.  If it completed successfully, it is OK to just return that status.\n\nShuhei - what do you think?",
      "revId": "e704b4ac0f83b8d1f631357d31011a626a9f4623",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cf3c2708_96198bfa",
        "filename": "lib/scsi/lun.c",
        "patchSetId": 4
      },
      "lineNbr": 77,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2017-11-16T00:30:49Z",
      "side": 1,
      "message": "SPDK cannot decouple LUN reset with asynchronous IO yet and hence the whole loop can be removed and Ziye\u0027s another patch will be better.\n\n\nIf SPDK can decouple LUN reset with asynchronous IO and can reply LUN reset without waiting outstanding tasks, \n\nAs long as I read specification and talked with colleagues, I think the following rule will be required:\n- for any IO request received prior to the LUN RESET request, normal response must be sent to the intiator prior to the LUN RESET response.\n- Hence CHECK_CONDITION when the above condition is detected is safer solution.\n\nBut this whole loop will be better to proceed together with decoupling function.",
      "parentUuid": "ed0194e6_a25f704f",
      "revId": "e704b4ac0f83b8d1f631357d31011a626a9f4623",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "61640adb_f875e581",
        "filename": "lib/scsi/lun.c",
        "patchSetId": 4
      },
      "lineNbr": 85,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2017-11-16T00:30:49Z",
      "side": 1,
      "message": "It looks that current SCSI implementation will always keep lun-\u003epending_tasks empty. Hence I think this whole loop can be removed too or further lun-\u003epending_tasks itself and related code can be removed too in another patch.",
      "range": {
        "startLine": 84,
        "startChar": 0,
        "endLine": 85,
        "endChar": 53
      },
      "revId": "e704b4ac0f83b8d1f631357d31011a626a9f4623",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4c845c2e_157760ff",
        "filename": "lib/scsi/lun.c",
        "patchSetId": 4
      },
      "lineNbr": 92,
      "author": {
        "id": 1012251
      },
      "writtenOn": "2017-11-15T05:46:37Z",
      "side": 1,
      "message": "Please look at bdev.c and check if my understanding is correct.",
      "range": {
        "startLine": 90,
        "startChar": 0,
        "endLine": 92,
        "endChar": 2
      },
      "revId": "e704b4ac0f83b8d1f631357d31011a626a9f4623",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0d38978a_e8dd48a9",
        "filename": "lib/scsi/lun.c",
        "patchSetId": 4
      },
      "lineNbr": 92,
      "author": {
        "id": 1011275
      },
      "writtenOn": "2017-11-15T06:12:20Z",
      "side": 1,
      "message": "bdev.c only handles tasks in lun-\u003etasks. For those tasks, it should let scsi_bdev\u0027s function: spdk_bdev_scsi_task_complete_cmd to complete the call back.\nSince spdk_scsi_lun_clear_all only set the task status, we do not need the status from the bdev layer anymore.\n\nAll the assumption is that: there are active lun tasks (lun-\u003etasks is not empty).",
      "parentUuid": "4c845c2e_157760ff",
      "range": {
        "startLine": 90,
        "startChar": 0,
        "endLine": 92,
        "endChar": 2
      },
      "revId": "e704b4ac0f83b8d1f631357d31011a626a9f4623",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f18ccc37_1b5b4a6b",
        "filename": "lib/scsi/scsi_bdev.c",
        "patchSetId": 4
      },
      "lineNbr": 1240,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2017-11-15T22:23:17Z",
      "side": 1,
      "message": "I\u0027m not sure this is needed - based on comment I made in lun.c.",
      "revId": "e704b4ac0f83b8d1f631357d31011a626a9f4623",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    }
  ]
}