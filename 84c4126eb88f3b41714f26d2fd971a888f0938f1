{
  "comments": [
    {
      "key": {
        "uuid": "839ede18_3916548d",
        "filename": "test/json_config/clear_config.py",
        "patchSetId": 1
      },
      "lineNbr": 45,
      "author": {
        "id": 1011221
      },
      "writtenOn": "2019-07-12T09:29:04Z",
      "side": 1,
      "message": "Actually this kind of behavior will occur in any module that creates more than one bdev - like split. As well there might be an issue with bdevs that depend on each other if delete proceeds only in the order that is returned by get_bdevs.",
      "range": {
        "startLine": 39,
        "startChar": 0,
        "endLine": 45,
        "endChar": 40
      },
      "revId": "84c4126eb88f3b41714f26d2fd971a888f0938f1",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d5623eaf_e279c0e6",
        "filename": "test/json_config/clear_config.py",
        "patchSetId": 1
      },
      "lineNbr": 45,
      "author": {
        "id": 1011262
      },
      "writtenOn": "2019-07-12T11:22:27Z",
      "side": 1,
      "message": "I don\u0027t think so. First: split does not use RPC. Second: there isn\u0027t any other bdev that creates bdevs while creating controller and remove bdevs by removing controller. This issue is valid only for NVMe controllers. Third: This function removes only NVMe bdevs, so the order of removal does not matter.",
      "parentUuid": "839ede18_3916548d",
      "range": {
        "startLine": 39,
        "startChar": 0,
        "endLine": 45,
        "endChar": 40
      },
      "revId": "84c4126eb88f3b41714f26d2fd971a888f0938f1",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5ad5449d_9d3a0535",
        "filename": "test/json_config/clear_config.py",
        "patchSetId": 1
      },
      "lineNbr": 83,
      "author": {
        "id": 1011221
      },
      "writtenOn": "2019-07-12T09:29:04Z",
      "side": 1,
      "message": "How about changing this patch to issue get_bdevs() again on each successful delete, until get_bdevs() does not return any bdev? List of bdevs would get updated, and any dependencies would be resolved as the bdevs get deleted.",
      "range": {
        "startLine": 75,
        "startChar": 0,
        "endLine": 83,
        "endChar": 72
      },
      "revId": "84c4126eb88f3b41714f26d2fd971a888f0938f1",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "41a03bc5_0edaa9bd",
        "filename": "test/json_config/clear_config.py",
        "patchSetId": 1
      },
      "lineNbr": 83,
      "author": {
        "id": 1011262
      },
      "writtenOn": "2019-07-12T11:22:27Z",
      "side": 1,
      "message": "This function does not base on get_bdevs output (rpc_bdevs) to select bdev for removal but on function argument (bdev_config), so reloading rpc_bdevs list won\u0027t solve that issue as we will still call remove function for original list passed with argument.",
      "parentUuid": "5ad5449d_9d3a0535",
      "range": {
        "startLine": 75,
        "startChar": 0,
        "endLine": 83,
        "endChar": 72
      },
      "revId": "84c4126eb88f3b41714f26d2fd971a888f0938f1",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b5b96ee1_8af69b31",
        "filename": "test/json_config/clear_config.py",
        "patchSetId": 1
      },
      "lineNbr": 83,
      "author": {
        "id": 1011218
      },
      "writtenOn": "2019-07-22T03:58:26Z",
      "side": 1,
      "message": "You might want to just iterate through get_nvme_controllers RPC output and remove all NVMe controllers\n\nThe code could do roughly:\nfor bdev in get_bdevs:\n  if get_bdev_destroy_method(bdev): // undefined for nvme\n    // remove the bdev (passthru, split, lvol, etc)\n\nfor nvme in get_nvme_controllers:\n  delete_nvme_controller ...\n\n\nIt doesn\u0027t actually matter if we delete nvmes before or after the other bdevs. Only lvols on top of NVMe could make a difference, but this script doesn\u0027t seem to delete them today so we don\u0027t need to care.",
      "parentUuid": "41a03bc5_0edaa9bd",
      "range": {
        "startLine": 75,
        "startChar": 0,
        "endLine": 83,
        "endChar": 72
      },
      "revId": "84c4126eb88f3b41714f26d2fd971a888f0938f1",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    }
  ]
}