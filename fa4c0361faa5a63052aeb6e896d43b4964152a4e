{
  "comments": [
    {
      "key": {
        "uuid": "c00768a1_75d0f9c8",
        "filename": "lib/vhost/vhost.c",
        "patchSetId": 5
      },
      "lineNbr": 478,
      "author": {
        "id": 1011230
      },
      "writtenOn": "2018-04-26T10:45:41Z",
      "side": 1,
      "message": "\"dev\" -\u003e \"tgt\"",
      "range": {
        "startLine": 477,
        "startChar": 0,
        "endLine": 478,
        "endChar": 35
      },
      "revId": "fa4c0361faa5a63052aeb6e896d43b4964152a4e",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "defd2185_dbf5b359",
        "filename": "lib/vhost/vhost.c",
        "patchSetId": 5
      },
      "lineNbr": 478,
      "author": {
        "id": 1011218
      },
      "writtenOn": "2018-04-26T18:26:15Z",
      "side": 1,
      "message": "vid is a device identifier. this is correct",
      "parentUuid": "c00768a1_75d0f9c8",
      "range": {
        "startLine": 477,
        "startChar": 0,
        "endLine": 478,
        "endChar": 35
      },
      "revId": "fa4c0361faa5a63052aeb6e896d43b4964152a4e",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "67b23979_0986574b",
        "filename": "lib/vhost/vhost.c",
        "patchSetId": 5
      },
      "lineNbr": 478,
      "author": {
        "id": 1011230
      },
      "writtenOn": "2018-04-27T12:43:33Z",
      "side": 1,
      "message": "Ohh, OK.",
      "parentUuid": "defd2185_dbf5b359",
      "range": {
        "startLine": 477,
        "startChar": 0,
        "endLine": 478,
        "endChar": 35
      },
      "revId": "fa4c0361faa5a63052aeb6e896d43b4964152a4e",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "34d1af08_c5298850",
        "filename": "lib/vhost/vhost_blk.c",
        "patchSetId": 5
      },
      "lineNbr": 451,
      "author": {
        "id": 1011230
      },
      "writtenOn": "2018-04-26T10:45:41Z",
      "side": 1,
      "message": "extra line",
      "revId": "fa4c0361faa5a63052aeb6e896d43b4964152a4e",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7028164e_72c55b96",
        "filename": "lib/vhost/vhost_scsi.c",
        "patchSetId": 5
      },
      "lineNbr": 286,
      "author": {
        "id": 1011230
      },
      "writtenOn": "2018-04-26T10:45:41Z",
      "side": 1,
      "message": "I don\u0027t the reason of going back and forward here. Also to_scsi_dev() introduce usless checks here. Why spdk_vhost_scsi_task can\u0027t have pointer to the spdk_vhost_scsi_dev?",
      "range": {
        "startLine": 285,
        "startChar": 0,
        "endLine": 286,
        "endChar": 55
      },
      "revId": "fa4c0361faa5a63052aeb6e896d43b4964152a4e",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6b5ffcf0_f7e28b63",
        "filename": "lib/vhost/vhost_scsi.c",
        "patchSetId": 5
      },
      "lineNbr": 286,
      "author": {
        "id": 1011218
      },
      "writtenOn": "2018-04-26T18:26:15Z",
      "side": 1,
      "message": "\u003e Why spdk_vhost_scsi_task can\u0027t have pointer to the spdk_vhost_scsi_dev?\n\nIt\u0027s just more handy to store vhost_dev pointers. You need spdk_vhost_dev for the most I/O operations as it is passed to all virtio.c APIs. vhost_scsi_dev won\u0027t hold anything but scsi device status and poller references.\n\n\u003e Also to_scsi_dev() introduce usless checks here.\n\nThat\u0027s right. I\u0027m adding to_scsi_dev_unsafe() for this purpose later on:\nhttps://review.gerrithub.io/c/spdk/spdk/+/405891/11/lib/vhost/vhost_scsi.c",
      "parentUuid": "7028164e_72c55b96",
      "range": {
        "startLine": 285,
        "startChar": 0,
        "endLine": 286,
        "endChar": 55
      },
      "revId": "fa4c0361faa5a63052aeb6e896d43b4964152a4e",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7d187c07_b2162f77",
        "filename": "lib/vhost/vhost_scsi.c",
        "patchSetId": 5
      },
      "lineNbr": 286,
      "author": {
        "id": 1011230
      },
      "writtenOn": "2018-04-27T12:43:33Z",
      "side": 1,
      "message": "I am asking why type of spdk_vhost_scsi_task::vdev is spdk_vhost_tgt? Why just make it spdk_vhost_scsi_dev?\n\nI now see you changed the whole logic here. vdev_worker now receive generic vhost device pointer. But why? Now you need explicit upcast that could be avoid if you use spdk_vhost_scsi_dev as it was up to now. Maybe there is good reason for that but can\u0027t see it. This is why I aske for squashing this with one of the next patches.",
      "parentUuid": "6b5ffcf0_f7e28b63",
      "range": {
        "startLine": 285,
        "startChar": 0,
        "endLine": 286,
        "endChar": 55
      },
      "revId": "fa4c0361faa5a63052aeb6e896d43b4964152a4e",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9c0c62e3_6fd96ca9",
        "filename": "lib/vhost/vhost_scsi.c",
        "patchSetId": 5
      },
      "lineNbr": 286,
      "author": {
        "id": 1011218
      },
      "writtenOn": "2018-04-27T13:51:30Z",
      "side": 1,
      "message": "\u003e why type of spdk_vhost_scsi_task::vdev is spdk_vhost_tgt?\n\nDid you mean spdk_vhost_dev?\n\nLet\u0027s assume spdk_vhost_scsi_task has a svdev pointer of type spdk_vhost_scsi_dev.\nNow if you want to call any of the following functions you need to manually convert it to spdk_vhost_dev:\n\n```\nspdk_vhost_vq_get_desc(struct spdk_vhost_dev *vdev, ...);\nspdk_vhost_vq_used_signal(struct spdk_vhost_dev *vdev, ...);\nspdk_vhost_dev_used_signal(struct spdk_vhost_dev *vdev);\nspdk_vhost_vq_used_ring_enqueue(struct spdk_vhost_dev *vdev, ...);\nspdk_vhost_vring_desc_to_iov(struct spdk_vhost_dev *vdev, ...);\netc\n```\n\n\u003e Now you need explicit upcast [...]\n\nConverting svdev to vdev is just as complex as converting vdev to svdev. There\u0027s no direct inheritance between those. No direct upcasting and downcasting. see here:\nhttps://review.gerrithub.io/c/spdk/spdk/+/405891/11/lib/vhost/vhost_internal.h#268\n\nWe can keep either vdev or svdev pointer in scsi_task, but vdev is more widely used and that\u0027s why I picked it.",
      "parentUuid": "7d187c07_b2162f77",
      "range": {
        "startLine": 285,
        "startChar": 0,
        "endLine": 286,
        "endChar": 55
      },
      "revId": "fa4c0361faa5a63052aeb6e896d43b4964152a4e",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    }
  ]
}