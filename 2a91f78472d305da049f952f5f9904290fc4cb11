{
  "comments": [
    {
      "key": {
        "uuid": "60709786_971332b8",
        "filename": "include/spdk/lvol.h",
        "patchSetId": 18
      },
      "lineNbr": 200,
      "author": {
        "id": 1010525
      },
      "writtenOn": "2018-05-03T22:21:16Z",
      "side": 1,
      "message": "This is probably a reasonable API to have, but it might be simpler to just make spdk_lvol_destroy() check this itself and call cb_fn with -EBUSY or similar.",
      "revId": "2a91f78472d305da049f952f5f9904290fc4cb11",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f7595fb8_91368faf",
        "filename": "include/spdk/lvol.h",
        "patchSetId": 18
      },
      "lineNbr": 200,
      "author": {
        "id": 1011211
      },
      "writtenOn": "2018-05-07T08:35:48Z",
      "side": 1,
      "message": "With only spdk_lvol_destroy() we have to possible scenarios:\n\n1. First we call spdk_lvol_destroy(), then spdk_bdev_unregister(). Between those calls we no longer have lvol, but we still have bdev. What should we do with I/O?\n\n2. First we call spdk_bdev_unregister(), all bdevs are unregistered. Then spdk_lvol_destroy() but it fails, what should we do? Re-register all the bdevs or leave unaccesible lvol?\n\nThat is why I introduced the above call.\nThis way we can first check if it is possible to delete lvol, then we unregister bdev and finally actually delete lvol.",
      "parentUuid": "60709786_971332b8",
      "revId": "2a91f78472d305da049f952f5f9904290fc4cb11",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "026b301c_9c60be66",
        "filename": "include/spdk_internal/lvolstore.h",
        "patchSetId": 18
      },
      "lineNbr": 112,
      "author": {
        "id": 1010525
      },
      "writtenOn": "2018-05-03T22:21:16Z",
      "side": 1,
      "message": "We should fix up the indentation here.",
      "revId": "2a91f78472d305da049f952f5f9904290fc4cb11",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d9218cf8_d471e95d",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 18
      },
      "lineNbr": 336,
      "author": {
        "id": 1011262
      },
      "writtenOn": "2018-05-07T14:06:23Z",
      "side": 1,
      "message": "You can add some log with lvolerrno to display if operation succeeded. This way we won\u0027t have empty function.",
      "range": {
        "startLine": 336,
        "startChar": 1,
        "endLine": 336,
        "endChar": 25
      },
      "revId": "2a91f78472d305da049f952f5f9904290fc4cb11",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "30a5356d_8b752693",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 18
      },
      "lineNbr": 336,
      "author": {
        "id": 1011211
      },
      "writtenOn": "2018-06-14T09:38:57Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "d9218cf8_d471e95d",
      "range": {
        "startLine": 336,
        "startChar": 1,
        "endLine": 336,
        "endChar": 25
      },
      "revId": "2a91f78472d305da049f952f5f9904290fc4cb11",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1557714c_865b98f1",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 18
      },
      "lineNbr": 522,
      "author": {
        "id": 1011262
      },
      "writtenOn": "2018-05-07T14:06:23Z",
      "side": 1,
      "message": "This can be something like vbdev_lvol_cloes now.",
      "range": {
        "startLine": 522,
        "startChar": 0,
        "endLine": 522,
        "endChar": 19
      },
      "revId": "2a91f78472d305da049f952f5f9904290fc4cb11",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d8b4a525_94ec47e8",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 18
      },
      "lineNbr": 522,
      "author": {
        "id": 1011211
      },
      "writtenOn": "2018-06-14T09:38:57Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "1557714c_865b98f1",
      "range": {
        "startLine": 522,
        "startChar": 0,
        "endLine": 522,
        "endChar": 19
      },
      "revId": "2a91f78472d305da049f952f5f9904290fc4cb11",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fef97530_4a0ed21b",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 18
      },
      "lineNbr": 537,
      "author": {
        "id": 1011262
      },
      "writtenOn": "2018-05-07T14:06:23Z",
      "side": 1,
      "message": "You should call spdk_lvol_close here and don\u0027t try to close lvol in destroy call, but just destroy it right away.",
      "revId": "2a91f78472d305da049f952f5f9904290fc4cb11",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c3276d32_dbe1d12b",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 18
      },
      "lineNbr": 537,
      "author": {
        "id": 1011211
      },
      "writtenOn": "2018-06-14T09:38:57Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "fef97530_4a0ed21b",
      "revId": "2a91f78472d305da049f952f5f9904290fc4cb11",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d9304863_8c7c103d",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 18
      },
      "lineNbr": 561,
      "author": {
        "id": 1010525
      },
      "writtenOn": "2018-05-03T22:11:26Z",
      "side": 1,
      "message": "This path seems to leave the mutex locked.",
      "revId": "2a91f78472d305da049f952f5f9904290fc4cb11",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c9081c8f_229cac91",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 18
      },
      "lineNbr": 561,
      "author": {
        "id": 1011211
      },
      "writtenOn": "2018-05-07T08:35:48Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "d9304863_8c7c103d",
      "revId": "2a91f78472d305da049f952f5f9904290fc4cb11",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "caa9c6a3_cfa87aac",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 18
      },
      "lineNbr": 564,
      "author": {
        "id": 1010525
      },
      "writtenOn": "2018-05-03T22:11:26Z",
      "side": 1,
      "message": "I\u0027m not sure why we needed to keep the mutex locked until here - it doesn\u0027t look like it\u0027s protecting anything in this function.",
      "revId": "2a91f78472d305da049f952f5f9904290fc4cb11",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7cbd1e46_e944e41a",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 18
      },
      "lineNbr": 573,
      "author": {
        "id": 1011262
      },
      "writtenOn": "2018-05-07T14:06:23Z",
      "side": 1,
      "message": "You don\u0027t need this in the context - you can read it from lvol structure.",
      "range": {
        "startLine": 573,
        "startChar": 26,
        "endLine": 573,
        "endChar": 35
      },
      "revId": "2a91f78472d305da049f952f5f9904290fc4cb11",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "73445ac7_ee22d27f",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 18
      },
      "lineNbr": 573,
      "author": {
        "id": 1011211
      },
      "writtenOn": "2018-06-14T09:38:57Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "7cbd1e46_e944e41a",
      "range": {
        "startLine": 573,
        "startChar": 26,
        "endLine": 573,
        "endChar": 35
      },
      "revId": "2a91f78472d305da049f952f5f9904290fc4cb11",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "818249e2_321707ce",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 18
      },
      "lineNbr": 599,
      "author": {
        "id": 1010525
      },
      "writtenOn": "2018-05-03T22:11:26Z",
      "side": 1,
      "message": "What is this for? It looks like ctx-\u003ebegin and ctx-\u003eend aren\u0027t used anywhere else.",
      "revId": "2a91f78472d305da049f952f5f9904290fc4cb11",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "04ed5bdd_12e0b4f3",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 18
      },
      "lineNbr": 599,
      "author": {
        "id": 1011211
      },
      "writtenOn": "2018-05-07T08:35:48Z",
      "side": 1,
      "message": "deubg code, fixed",
      "parentUuid": "818249e2_321707ce",
      "revId": "2a91f78472d305da049f952f5f9904290fc4cb11",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "895a97ee_900b30b0",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 18
      },
      "lineNbr": 608,
      "author": {
        "id": 1010525
      },
      "writtenOn": "2018-05-03T22:21:16Z",
      "side": 1,
      "message": "Is it OK if we delete the alias but then can\u0027t delete the lvol below? (Also, it might be better to just make spdk_bdev_unregister() delete all the aliases instead of making each bdev module clean them up.)",
      "revId": "2a91f78472d305da049f952f5f9904290fc4cb11",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fc9d23e9_d3f35de9",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 18
      },
      "lineNbr": 608,
      "author": {
        "id": 1011211
      },
      "writtenOn": "2018-05-07T08:35:48Z",
      "side": 1,
      "message": "I\u0027m not sure. \ndelete_bdev is mainly for testing purposes, right? \n\nWe could add additional call to register existing lvol as bdev (this could also possibly simplify actual destroy_lvol_bdev path)\nWhat do you think?",
      "parentUuid": "895a97ee_900b30b0",
      "revId": "2a91f78472d305da049f952f5f9904290fc4cb11",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9b37326c_75698156",
        "filename": "lib/bdev/lvol/vbdev_lvol.c",
        "patchSetId": 18
      },
      "lineNbr": 608,
      "author": {
        "id": 1011262
      },
      "writtenOn": "2018-05-07T14:06:23Z",
      "side": 1,
      "message": "Daniel probably had in mind that we should add functionality of deleting aliases in spdk_bdev_unregister function which you call in line 617. This way, when deleting lvol will fail, we will know that we have to register alias again when re-registering bdev.",
      "parentUuid": "fc9d23e9_d3f35de9",
      "revId": "2a91f78472d305da049f952f5f9904290fc4cb11",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    }
  ]
}