{
  "comments": [
    {
      "key": {
        "uuid": "aff082d8_a2eae92f",
        "filename": "module/bdev/nvme/bdev_ocssd.c",
        "patchSetId": 32
      },
      "lineNbr": 320,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2019-12-06T22:40:53Z",
      "side": 1,
      "message": "later this gets changed to support just one zone\n\nI\u0027d rather just make that restriction here, to reduce the diff on the future patch",
      "revId": "fb398ac3f0611149d67afb4c21e5491290252900",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "72c06579_409ff668",
        "filename": "module/bdev/nvme/bdev_ocssd.c",
        "patchSetId": 32
      },
      "lineNbr": 320,
      "author": {
        "id": 1015368
      },
      "writtenOn": "2019-12-09T13:42:54Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "aff082d8_a2eae92f",
      "revId": "fb398ac3f0611149d67afb4c21e5491290252900",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "70f968aa_bf718a37",
        "filename": "module/bdev/nvme/bdev_ocssd.c",
        "patchSetId": 32
      },
      "lineNbr": 336,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2019-12-05T16:57:04Z",
      "side": 1,
      "message": "should we allow unmap on a zoned device?\n\nI don\u0027t think in general this is very useful.  If UNMAP does not describe an entire zone, then it will always fail - and what should user do in that case?\n\nI think it\u0027s OK to just not support UNMAP here, but would like to hear your input.\n\n(Marking -1 for now while we work through this question.  The code itself looks fine if we decide to keep UNMAP here.)",
      "revId": "fb398ac3f0611149d67afb4c21e5491290252900",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "065976bc_53a53b5c",
        "filename": "module/bdev/nvme/bdev_ocssd.c",
        "patchSetId": 32
      },
      "lineNbr": 336,
      "author": {
        "id": 1015368
      },
      "writtenOn": "2019-12-06T08:31:43Z",
      "side": 1,
      "message": "Is there a reason for not wanting to support it? As you\u0027ve said, it\u0027s very similar to a zone reset, but requires some extra parameter checks. I\u0027d expect the user to be aware he\u0027s using a zoned device and not a regular block one, so he should understand the additional requirements imposed on the unmap command.\n\nThe reason I\u0027ve decided to implement it is because the unmap command is pretty standard, which makes it possible to use existing tools to send it - I\u0027ve used blkdiscard(8) on an nbd device to test the zone reset/unmap implementation.",
      "parentUuid": "70f968aa_bf718a37",
      "revId": "fb398ac3f0611149d67afb4c21e5491290252900",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "32a3f167_c94c006a",
        "filename": "module/bdev/nvme/bdev_ocssd.c",
        "patchSetId": 32
      },
      "lineNbr": 336,
      "author": {
        "id": 1011222
      },
      "writtenOn": "2019-12-06T21:49:11Z",
      "side": 1,
      "message": "The reason to not support it is that it\u0027s not clear to me that it\u0027s a requirement for SPDK to allow.  That\u0027s always a big reason for me.  :-)\n\nIf the user is aware he\u0027s using a zoned device, then he can just use zone reset.  It\u0027s OK for us to dictate things like this to the user.\n\nI\u0027m reading the latest NVMe ZNS spec, and it\u0027s not really clear on whether DSM deallocate is supported is supported for zoned namespaces.  I\u0027ve sent an e-mail out to Matias for clarification.  If it\u0027s supported for NVMe ZNS, then I agree we should add it in SPDK.  If not, I\u0027d say we don\u0027t allow it and force users to zone reset.\n\nAnd if it is supported by NVMe, we should consider putting this code up in the generic bdev layer, since it would be common to all zoned bdevs.\n\nDoes that sound OK with you?",
      "parentUuid": "065976bc_53a53b5c",
      "revId": "fb398ac3f0611149d67afb4c21e5491290252900",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8171d367_0a91d138",
        "filename": "module/bdev/nvme/bdev_ocssd.c",
        "patchSetId": 32
      },
      "lineNbr": 336,
      "author": {
        "id": 1015368
      },
      "writtenOn": "2019-12-09T13:42:54Z",
      "side": 1,
      "message": "Oh, I didn\u0027t consider the possibility of sending DSM deallocate, I\u0027ve just assumed that the unmap should behave the same way as zone reset.\nAs you\u0027ve suggested, I\u0027ve split this patch and put the unmap one at the top of the chain.",
      "parentUuid": "32a3f167_c94c006a",
      "revId": "fb398ac3f0611149d67afb4c21e5491290252900",
      "serverId": "d5d70762-12d0-45a1-890d-524b12d3f735",
      "unresolved": false
    }
  ]
}